(()=>{const rb=new WeakMap(),X=a=>typeof a==="function"&&rb.has(a);const ya=typeof window!=="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,ma=(a,c,d=null)=>{for(;c!==d;){const e=c.nextSibling;a.removeChild(c),c=e}};const A={},U={};const F=`{{lit-${String(Math.random()).slice(2)}}}`,Ba=`<!--${F}-->`,nb=new RegExp(`${F}|${Ba}`),Y="$lit$";class kb{constructor(a,c){this.parts=[],this.element=c;const d=[],e=[],f=document.createTreeWalker(c.content,133,null,!1);let h=0,g=-1,m=0;const{strings:J,values:{length:j}}=a;for(;m<j;){const k=f.nextNode();if(k===null){f.currentNode=e.pop();continue}g++;if(k.nodeType===1){if(k.hasAttributes()){const p=k.attributes,{length:P}=p;let G=0;for(let q=0;q<P;q++)ob(p[q].name,Y)&&G++;for(;G-- >0;){const q=J[m],y=oa.exec(q)[2],D=y.toLowerCase()+Y,Q=k.getAttribute(D);k.removeAttribute(D);const K=Q.split(nb);this.parts.push({type:"attribute",index:g,name:y,strings:K}),m+=K.length-1}}k.tagName==="TEMPLATE"&&(e.push(k),f.currentNode=k.content)}else if(k.nodeType===3){const p=k.data;if(p.indexOf(F)>=0){const P=k.parentNode,G=p.split(nb),q=G.length-1;for(let y=0;y<q;y++){let D,Q=G[y];if(Q==="")D=I();else{const K=oa.exec(Q);K!==null&&ob(K[2],Y)&&(Q=Q.slice(0,K.index)+K[1]+K[2].slice(0,-Y.length)+K[3]),D=document.createTextNode(Q)}P.insertBefore(D,k),this.parts.push({type:"node",index:++g})}G[q]===""?(P.insertBefore(I(),k),d.push(k)):k.data=G[q],m+=q}}else if(k.nodeType===8)if(k.data===F){const p=k.parentNode;(k.previousSibling===null||g===h)&&(g++,p.insertBefore(I(),k)),h=g,this.parts.push({type:"node",index:g}),k.nextSibling===null?k.data="":(d.push(k),g--),m++}else{let p=-1;for(;(p=k.data.indexOf(F,p+1))!==-1;)this.parts.push({type:"node",index:-1}),m++}}for(const k of d)k.parentNode.removeChild(k)}}const ob=(a,c)=>{const d=a.length-c.length;return d>=0&&a.slice(d)===c},mb=a=>a.index!==-1,I=()=>document.createComment(""),oa=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class za{constructor(a,c,d){this.__parts=[],this.template=a,this.processor=c,this.options=d}update(a){let c=0;for(const d of this.__parts)d!==void 0&&d.setValue(a[c]),c++;for(const d of this.__parts)d!==void 0&&d.commit()}_clone(){const a=ya?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),c=[],d=this.template.parts,e=document.createTreeWalker(a,133,null,!1);let f=0,h=0,g,m=e.nextNode();for(;f<d.length;){g=d[f];if(!mb(g)){this.__parts.push(void 0),f++;continue}for(;h<g.index;)h++,m.nodeName==="TEMPLATE"&&(c.push(m),e.currentNode=m.content),(m=e.nextNode())===null&&(e.currentNode=c.pop(),m=e.nextNode());if(g.type==="node"){const J=this.processor.handleTextExpression(this.options);J.insertAfterNode(m.previousSibling),this.__parts.push(J)}else this.__parts.push(...this.processor.handleAttributeExpressions(m,g.name,g.strings,this.options));f++}return ya&&(document.adoptNode(a),customElements.upgrade(a)),a}}const ub=` ${F} `;class na{constructor(a,c,d,e){this.strings=a,this.values=c,this.type=d,this.processor=e}getHTML(){const a=this.strings.length-1;let c="",d=!1;for(let e=0;e<a;e++){const f=this.strings[e],h=f.lastIndexOf("<!--");d=(h>-1||d)&&f.indexOf("-->",h+1)===-1;const g=oa.exec(f);g===null?c+=f+(d?ub:Ba):c+=f.substr(0,g.index)+g[1]+g[2]+Y+g[3]+F}return c+=this.strings[a],c}getTemplateElement(){const a=document.createElement("template");return a.innerHTML=this.getHTML(),a}}const Aa=a=>a===null||!(typeof a==="object"||typeof a==="function"),fb=a=>Array.isArray(a)||!!(a&&a[Symbol.iterator]);class xa{constructor(a,c,d){this.dirty=!0,this.element=a,this.name=c,this.strings=d,this.parts=[];for(let e=0;e<d.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new gb(this)}_getValue(){const a=this.strings,c=a.length-1;let d="";for(let e=0;e<c;e++){d+=a[e];const f=this.parts[e];if(f!==void 0){const h=f.value;if(Aa(h)||!fb(h))d+=typeof h==="string"?h:String(h);else for(const g of h)d+=typeof g==="string"?g:String(g)}}return d+=a[c],d}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class gb{constructor(a){this.value=void 0,this.committer=a}setValue(a){a!==A&&(!Aa(a)||a!==this.value)&&(this.value=a,X(a)||(this.committer.dirty=!0))}commit(){for(;X(this.value);){const a=this.value;this.value=A,a(this)}if(this.value===A)return;this.committer.commit()}}class aa{constructor(a){this.value=void 0,this.__pendingValue=void 0,this.options=a}appendInto(a){this.startNode=a.appendChild(I()),this.endNode=a.appendChild(I())}insertAfterNode(a){this.startNode=a,this.endNode=a.nextSibling}appendIntoPart(a){a.__insert(this.startNode=I()),a.__insert(this.endNode=I())}insertAfterPart(a){a.__insert(this.startNode=I()),this.endNode=a.endNode,a.endNode=this.startNode}setValue(a){this.__pendingValue=a}commit(){if(this.startNode.parentNode===null)return;for(;X(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=A,c(this)}const a=this.__pendingValue;if(a===A)return;Aa(a)?a!==this.value&&this.__commitText(a):a instanceof na?this.__commitTemplateResult(a):a instanceof Node?this.__commitNode(a):fb(a)?this.__commitIterable(a):a===U?(this.value=U,this.clear()):this.__commitText(a)}__insert(a){this.endNode.parentNode.insertBefore(a,this.endNode)}__commitNode(a){if(this.value===a)return;this.clear(),this.__insert(a),this.value=a}__commitText(a){const c=this.startNode.nextSibling;a=a==null?"":a;const d=typeof a==="string"?a:String(a);c===this.endNode.previousSibling&&c.nodeType===3?c.data=d:this.__commitNode(document.createTextNode(d)),this.value=a}__commitTemplateResult(a){const c=this.options.templateFactory(a);if(this.value instanceof za&&this.value.template===c)this.value.update(a.values);else{const d=new za(c,a.processor,this.options),e=d._clone();d.update(a.values),this.__commitNode(e),this.value=d}}__commitIterable(a){Array.isArray(this.value)||(this.value=[],this.clear());const c=this.value;let d=0,e;for(const f of a)e=c[d],e===void 0&&(e=new aa(this.options),c.push(e),d===0?e.appendIntoPart(this):e.insertAfterPart(c[d-1])),e.setValue(f),e.commit(),d++;d<c.length&&(c.length=d,this.clear(e&&e.endNode))}clear(a=this.startNode){ma(this.startNode.parentNode,a.nextSibling,this.endNode)}}class bb{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0;if(d.length!==2||d[0]!==""||d[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=a,this.name=c,this.strings=d}setValue(a){this.__pendingValue=a}commit(){for(;X(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=A,c(this)}if(this.__pendingValue===A)return;const a=!!this.__pendingValue;this.value!==a&&(a?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=a),this.__pendingValue=A}}class db extends xa{constructor(a,c,d){super(a,c,d);this.single=d.length===2&&d[0]===""&&d[1]===""}_createPart(){return new sb(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class sb extends gb{}let hb=!1;(()=>{try{const a={get capture(){return hb=!0,!1}};window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch(a){}})();class cb{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0,this.element=a,this.eventName=c,this.eventContext=d,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(a){this.__pendingValue=a}commit(){for(;X(this.__pendingValue);){const f=this.__pendingValue;this.__pendingValue=A,f(this)}if(this.__pendingValue===A)return;const a=this.__pendingValue,c=this.value,d=a==null||c!=null&&(a.capture!==c.capture||a.once!==c.once||a.passive!==c.passive),e=a!=null&&(c==null||d);d&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),e&&(this.__options=tb(a),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=a,this.__pendingValue=A}handleEvent(a){typeof this.value==="function"?this.value.call(this.eventContext||this.element,a):this.value.handleEvent(a)}}const tb=a=>a&&(hb?{capture:a.capture,passive:a.passive,once:a.once}:a.capture);class qb{handleAttributeExpressions(a,c,d,e){const f=c[0];if(f==="."){const g=new db(a,c.slice(1),d);return g.parts}if(f==="@")return[new cb(a,c.slice(1),e.eventContext)];if(f==="?")return[new bb(a,c.slice(1),d)];const h=new xa(a,c,d);return h.parts}handleTextExpression(a){return new aa(a)}}const eb=new qb();function ib(a){let c=lb.get(a.type);c===void 0&&(c={stringsArray:new WeakMap(),keyString:new Map()},lb.set(a.type,c));let d=c.stringsArray.get(a.strings);if(d!==void 0)return d;const e=a.strings.join(F);return d=c.keyString.get(e),d===void 0&&(d=new kb(a,a.getTemplateElement()),c.keyString.set(e,d)),c.stringsArray.set(a.strings,d),d}const lb=new Map();const jb=new WeakMap(),O=(a,c,d)=>{let e=jb.get(c);e===void 0&&(ma(c,c.firstChild),jb.set(c,e=new aa(Object.assign({templateFactory:ib},d))),e.appendInto(c)),e.setValue(a),e.commit()};typeof window!=="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const i=(a,...c)=>new na(a,c,"html",eb);let v=a=>document.getElementById(a);function Z(){return Math.round(new Date().getTime()*Math.random())}function _(a=""){return a.replace(/\W+|[-_]/g,"-")}function*C(a,c){for(let d of a)yield{section:d,parent:c},d.children&&(yield*C(d.children,d))}function t(a){let c=a.closest("section");return parseInt(c.id)}function V(a){let c=a.closest(".field");return parseInt(c.id)}function E(a){let c;for(let{section:d,parent:e}of C(b.now.children))if(d.id==a){c=d;break}return c}function la(a){let c=a.closest("section"),d=c.getAttribute("data-section-depth");return parseInt(d)}function ia(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d-1,0,f),n(),l(),b.hasChanged=!0,document.activeElement.blur();try{document.querySelector(`[id="${f.id}"] .moveUp`)?.focus()}catch(h){}}function ha(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d+1,0,f),n(),l(),b.hasChanged=!0,document.activeElement.blur();try{document.querySelector(`[id="${f.id}"] .moveDown`)?.focus()}catch(h){}}function M(){b.now.fieldTypes=b.now.selected.template.fieldTypes||[],b.now.globalTypes=b.now.selected.template.globalTypes||b.now.globalTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{},b.now.selected.globalType=b.now.globalTypes?.[0]||{};for(let{section:a,parent:c}of C(b.now.children)){if(!a.fields.length)continue;a.fields.map(d=>{d.type=b.now.fieldTypes.find(e=>e.id==d.type?.id)||b.now.fieldTypes?.[0]})}}class L{constructor(a=0){this.id=Z(),this.depth=a,this.text="",this.html="",this.children=[],this.fields=[]}}class ca{constructor(){this.id=Z(),this.value="",this.type=0}}class pa{constructor(a){this.id=Z(),this.name=a,this.css=""}}class Ca{constructor(a){this.id=Z(),this.name=a}}class da extends Ca{constructor(a){super(a);this.type="field type",this.css=""}}class ea extends Ca{constructor(a){super(a);this.type="template",this.fieldTypes=[],this.globalTypes=[]}}const z=["Chapter","Section","Block"],R={h1:"Lvl 1 Heading",h2:"Lvl 2 Heading",h3:"Lvl 3 Heading",h4:"Lvl 4 Heading",h5:"Lvl 5 Heading",h6:"Lvl 6 Heading",hr:"Horizontal Rules",p:"Paragraph",blockquote:"Block Quote",ul:"Unordered List",ol:"Ordered List",li:"List Item",a:"Link",strong:"Bolded Text",em:"Italic Text",code:"Code",img:"Image"},w={previewPane:v("preview"),toolbar:v("toolbar"),contentEditorPane:v("content_editor"),styleEditorPane:v("style_editor"),modal:v("modal"),customStyles:v("custom_styles"),walkThroughDialogue:v("walkthrough_dialogue"),mobileNav:v("mobile_nav")},H={throttle:60,mobileBreakpoint:960,saveInterval:2000,zoom:{min:.5,max:2,interval:.1}};let Da;try{Da=JSON.parse(localStorage.getItem("State"))}catch(a){console.log("No previous data found.")}const b=Da||{now:{children:[],fieldTypes:[],globalTypes:z.map(a=>new pa(a)).concat(Object.values(R).map(a=>new pa(a))),selected:{fieldType:{},globalType:{},template:{}},editing:{}},nowIndex:0,settings:{zoom:1,darkMode:!1,advancedUI:!1,messagesShown:!1},walkthroughIndex:0,history:[],templates:[],hasChanged:!1,isNewUser:!0,isMobile:innerWidth<=H.mobileBreakpoint,lastSaved:new Date(),forExport:""};const Wa=a=>{let c=t(a.target),d=la(a.target),e;for(let{section:f,parent:h}of C(b.now.children,b.now))if(f.id==c){let g=new L(d);h.children.push(g),e=g.id;break}b.hasChanged=!0,n(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Xa=a=>{let c=t(a.target),d=la(a.target),e;for(let{section:f,parent:h}of C(b.now.children,b.now))if(f.id==c){let g=new L(d+1);f.children.unshift(g),e=g.id;break}b.hasChanged=!0,n(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Ya=a=>{let c=t(a.target);for(let{section:d,parent:e}of C(b.now.children,b.now)){if(d.id!=c)continue;e.children=e.children.filter(f=>f!=d)}b.hasChanged=!0,l(),n()};const Za=a=>{let c=t(a.target),d=E(c);d.text=a.target.value,b.hasChanged=!0,l()};const S={addSiblingSection:Wa,addChildSection:Xa,removeSection:Ya,updateSection:Za};const La=a=>{let c=t(a.target),d=E(c),e=new ca();e.type=b.now.fieldTypes[0],d.fields.push(e),b.hasChanged=!0,n(),b.isMobile||document.querySelector(`[id="${e.id}"] input`)?.focus()};const Ma=a=>{let c=t(a.target),d=E(c),e=V(a.target);d.fields=d.fields.filter(f=>f.id!=e),b.hasChanged=!0,n(),l()};const Na=a=>{let c=t(a.target),d=E(c),e=V(a.target),f=d.fields.find(h=>h.id==e);f.value=a.target.value,b.hasChanged=!0,l()};const Oa=a=>{let c=a.target.value,d=V(a.target),e=t(a.target),f=E(e),h=f.fields.find(g=>g.id==d);h.type=b.now.fieldTypes.find(g=>g.id==c),b.hasChanged=!0,l()};const N={addField:La,removeField:Ma,updateFieldValue:Na,updateFieldType:Oa};const _a=a=>{let c=a.target.textContent||"";a.target.id.includes("global")&&(b.now.selected.globalType.css=c,b.hasChanged=!0),a.target.id.includes("field")&&(b.now.selected.fieldType.css=c,b.hasChanged=!0),s()};const W=a=>{let c=a.target||a,d=(e,f)=>`<span class="token ${f}">${e}</span>`;c.innerHTML=c.innerText.replace(/\n/g,"").replace(/;/g,d(";","newline")).replace(/[,:](?!\s)/g,e=>e+" ")};const $a=a=>{let c=a.target.value,d=v("field_type_styles"),e=b.now.fieldTypes.find(f=>f.id==c);if(e)e.css||(e.css=""),b.now.selected.fieldType=e;else{let f={id:c,css:""};b.now.fieldTypes.push(f),b.now.selected.fieldType=f}d.innerHTML=b.now.selected.fieldType.css,W(d),b.hasChanged=!0,l()};const ab=a=>{let c=v("global_type_styles"),d=a.target.value,e=b.now.globalTypes.find(f=>f.name==d);if(e)e.css||(e.css=""),b.now.selected.globalType=e;else{let f={id:d,css:""};b.now.globalTypes.push(f),b.now.selected.globalType=f}c.innerHTML=b.now.selected.globalType.css,W(c),b.hasChanged=!0,l()};const B={updateStyles:_a,updateCurrentFieldType:$a,updateCurrentGlobalType:ab,formatCSS:W};const Ha=a=>{if(a=="template"){b.templates=b.templates.filter(c=>JSON.parse(c).id!=b.now.selected.template.id);try{b.now.selected.template=JSON.parse(b.templates?.[0])||{}}catch(c){}}a=="field type"&&(b.now.fieldTypes=b.now.fieldTypes.filter(c=>c.id!=b.now.selected.fieldType.id),b.now.selected.template.fieldTypes=b.now.fieldTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{}),b.now.editing={},b.hasChanged=!0,u(null),n(),o(),r(),s(),l()};const Ia=a=>{b.now.editing[a.target.name]=a.target.value,b.now.editing?.type=="template"&&b.templates.map((c,d)=>{let e=JSON.parse(c),f=e.id==b.now.editing.id;f&&b.templates.splice(d,1,JSON.stringify(b.now.editing))}),b.hasChanged=!0,n(),o(),r(),s()};const Ka=()=>{b.now.selected.fieldType=b.now.fieldTypes[b.now.fieldTypes.length-1],b.now.selected.template.fieldTypes=b.now.fieldTypes;if(b.now.fieldTypes.length==1)for(let{section:a,parent:c}of C(b.now.children))a.fields.map(d=>d.type=b.now.fieldTypes[0])};const Ja=a=>{b.now.editing.name=b.now.editing.name.trim();if(!b.now.editing.name.length){u(null);return}a=="field type"&&(b.now.fieldTypes.push(new da(b.now.editing.name)),Ka(),w.styleEditorPane.querySelector("code")?.focus());if(a=="template"){let c=new ea(b.now.editing.name);c.fieldTypes=b.now.fieldTypes,c.globalTypes=b.now.globalTypes,b.templates.push(JSON.stringify(c)),b.now.selected.template=c}b.now.editing={},b.hasChanged=!0,n(),o(),l(),r(),u(null)};const $={removeType:Ha,updateType:Ia,saveNewType:Ja};const Pa=a=>{let c=b.settings.darkMode;document.documentElement.classList.toggle("dark_mode",!c),b.settings.darkMode=!c,b.hasChanged=!0,o()};const Qa=a=>{let c=b.settings.advancedUI;document.documentElement.classList.toggle("advanced",!c),b.settings.advancedUI=!c,b.hasChanged=!0,o()};const ka=a=>{if(!confirm("Are you sure you want to load this template?"))return;for(let c of b.templates){let d=JSON.parse(c);if(d.id==a.target.value){b.now.selected.template=d,M(),n(),o(),l(),r(),s(),b.hasChanged=!0;break}}};const Ra=a=>window.print();const Sa=a=>{let c=a.target.files[0],d=new FileReader();d.onerror=function(){console.error(this.error)},d.onload=function(){let e=JSON.parse(this.result);Object.keys(b).map(f=>b[f]=e[f]),M(),n(),o(),l(),r(),s()},document.body.classList.add("importing"),d.readAsText(c)};const Ta=a=>{b.now.children=[],b.now.fieldTypes=[],b.now.editing={},b.now.selected={fieldType:{},globalType:{},template:{}},b.templates=[],b.settings={zoom:1,darkMode:!1,advancedUI:!1},n(),o(),l(),r(),s(),b.now.children.push(new L()),n(),b.hasChanged=!0};const Ua=a=>{document.body.setAttribute("data-selected-pane",a)};const Va=(a="")=>{let c=a.toLowerCase(),d=b.settings.zoom;c=="out"&&d>H.zoom.min&&(d=d-H.zoom.interval),c=="in"&&d<H.zoom.max&&(d=d+H.zoom.interval),d!=b.settings.zoom&&(b.settings.zoom=d,b.hasChanged=!0,o())};const x={toggleDarkMode:Pa,toggleAdvancedUI:Qa,loadTemplate:ka,printDocument:Ra,importData:Sa,clearData:Ta,switchPane:Ua,zoom:Va};const ja=({global:a=!1,field:c={}}={})=>{if(!b.now.fieldTypes?.length)return;let d=a?b.now.selected.fieldType?.id:c?.type?.id;return i`
    <select name=type @input=${a?B.updateCurrentFieldType:N.updateFieldType}>

        ${b.now.fieldTypes.map(e=>i`
            <option value=${e.id} ?selected=${e.id==d}>
                ${e.name}
            </option>
        `)}

    </select>`};const Fa=(a,c,d)=>i`
<div 
class=field 
id=${a.id}>

    <input 
    placeholder="Field value..."
    type=text 
    .value=${a.value} 
    @input=${N.updateFieldValue} />

    ${ja({field:a})}

    <button 
    @click=${N.removeField} 
    class=remove>
        Remove
    </button>

    <button
    data-icon
    @click=${ha.bind(void 0,c,"fields",d)}
    ?disabled=${d>=c.fields.length-1}
    class="move moveDown">
    </button>

    <button
    data-icon
    @click=${ia.bind(void 0,c,"fields",d)}
    ?disabled=${!d} 
    class="move moveUp">
    </button>

</div>`;function fa(a,c,d){let e=b.now.children.length,f=a.depth,h=f==z.length-1;return i`
    <section 
    id=${a.id} 
    data-section-depth=${a.depth}>

        <div class=fields>
            ${a.fields.map((g,m)=>Fa(g,a,m))}
        </div>

        <textarea 
        id="${a.id}-text"
        placeholder=${"Write something for this "+z[f].toLowerCase()+"..."} 
        @input=${S.updateSection} 
        .value=${a.text}>
        </textarea>

        <div class=actions>

            <button 
            data-icon=add_another
            title=${"Add "+z[f]}
            @click=${S.addSiblingSection}>
            </button>

            ${h?"":i`
            <button 
            data-icon=add_sub
            title=${"Add "+z[f+1]}
            @click=${S.addChildSection}>
            </button>`}

            <button 
            class=add
            data-icon
            title="Add Field"
            @click=${N.addField}>
            </button>

            ${e>1||f?i`
            <button 
            class=remove
            @click=${S.removeSection}>
            Remove
            </button>`:""}

            ${c.children.length>1?i`

            <button 
            class="move moveDown" 
            data-icon
            title="Move Down"
            ?disabled=${d>=c.children.length-1} 
            @click=${ha.bind(this,c,"children",d)}>
            </button>

            <button 
            class="move moveUp"
            data-icon
            title="Move Up"
            ?disabled=${!d} 
            @click=${ia.bind(this,c,"children",d)}>
            </button>
            
            `:""}

        </div>

        ${a.children.length?a.children.map((g,m)=>fa(g,a,m)):""}

    </section>`}const vb={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function pb(a){return a.replace(RegExp("^"+(a.match(/^(\t| )+/)||"")[0],"gm"),"")}function ba(a){return(a+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function T(a,c){let d=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,e=[],f="",h=c||{},g=0,m,J,j,k,p;function P(q){let y=vb[q[1]||""],D=e[e.length-1]==q;return y?y[1]?(D?e.pop():e.push(q),y[D|0]):y[0]:q}function G(){let q="";for(;e.length;)q+=P(e[e.length-1]);return q}for(a=a.replace(/^\[(.+?)\]:\s*(.+)$/gm,(q,y,D)=>(h[y.toLowerCase()]=D,"")).replace(/^\n+|\n+$/g,"");j=d.exec(a);)J=a.substring(g,j.index),g=d.lastIndex,m=j[0],J.match(/[^\\](\\\\)*\\$/)||((p=j[3]||j[4])?m='<pre class="code '+(j[4]?"poetry":j[2].toLowerCase())+'"><code'+(j[2]?` class="language-${j[2].toLowerCase()}"`:"")+">"+pb(ba(p).replace(/^\n+|\n+$/g,""))+"</code></pre>":(p=j[6])?(p.match(/\./)&&(j[5]=j[5].replace(/^\d+/gm,"")),k=T(pb(j[5].replace(/^\s*[>*+.-]/gm,""))),p==">"?p="blockquote":(p=p.match(/\./)?"ol":"ul",k=k.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),m="<"+p+">"+k+"</"+p+">"):j[8]?m=`<img src="${ba(j[8])}" alt="${ba(j[7])}">`:j[10]?(f=f.replace("<a>",`<a href="${ba(j[11]||h[J.toLowerCase()])}">`),m=G()+"</a>"):j[9]?m="<a>":j[12]||j[14]?(p="h"+(j[14]?j[14].length:j[13]>"="?1:2),m="<"+p+">"+T(j[12]||j[15],h)+"</"+p+">"):j[16]?m="<code>"+ba(j[16])+"</code>":(j[17]||j[1])&&(m=P(j[17]||"--"))),f+=J,f+=m;return(f+a.substring(g)+G()).replace(/^\n+|\n+$/g,"")}const Ga=a=>{let c=b.now.fieldTypes.find(e=>e.id==a?.type?.id),d=document.createElement("div");return d.innerHTML=T(a.value),/<p>/.test(d.innerHTML)&&(d.innerHTML=d.firstElementChild.innerHTML),i`
    <div class=${_(c?.name||"")}>
        ${d}
    </div>`};function ga(a){let c=document.createElement("div");return c.classList.add("content"),c.innerHTML=T(a.text),i`
    <section class=${z[a.depth]}>
    
        ${a.fields.map(d=>Ga(d))}
    
        ${a.text.length?c:""}
    
        ${a.children.map(d=>ga(d))}
    
    </section>`}const sa=()=>i`

<div class="heading">
    Style Editor
    <span tabindex="0" data-tooltip="This pane is for editing your document's styles. Apply valid CSS rules to any custom field type or global element."></span>
</div>

<section id=manageFieldTypes>

    <div class=actions>

        <label>Field Styles</label>

        ${ja({global:!0})}

        ${b.now.fieldTypes?.length?i`
        <button 
        data-icon
        title="Edit Field Type"
        @click=${u.bind(void 0,"field type",!0)}>
        </button>`:""}

        <button 
        class=add 
        data-icon
        title="New Field Type"
        @click=${u.bind(void 0,"field type",!1)}>
        </button>
        
    </div>

    <code 
    spellcheck=false
    id=field_type_styles
    class=language-css 
    contenteditable=true 
    @focusout=${B.formatCSS}
    @keyup=${B.updateStyles}></code>
    
</section>


<section id=manageGlobalTypes>

    <div class=actions>

        <label>Global Styles</label>

        <select id=global-style-select @input=${B.updateCurrentGlobalType}>

            <optgroup label=Layout>
            ${z.map(a=>i`
                <option
                value=${a}
                ?selected=${a==b.now.selected.globalType?.name}>
                    ${a}s
                </option>
            `)}
            </optgroup>

            <optgroup label=Elements>
                ${Object.values(R).map(a=>i`
                    <option 
                    label=${a}
                    value=${a}
                    ?selected=${a==b.now.selected.globalType?.name}>
                        ${a}s
                    </option>
                `)}
            </optgroup>
        </select>

    </div>

    <code
    spellcheck=false
    id=global_type_styles
    class=language-css
    contenteditable=true
    @focusout=${B.formatCSS}
    @keyup=${B.updateStyles}></code>

</section>
`;const ta=()=>i`

${b.now.fieldTypes.map(a=>`#preview .${_(a.name).trim()}{${a.css}}`)}

${z.map(a=>{let c=b.now.globalTypes.find(d=>d.name==a);return`#preview .${_(a).trim()}{${c?.css}}`})}

${Object.keys(R).map(a=>{let c=R[a],d=b.now.globalTypes.find(e=>e.name==c);return`#preview ${a} {${d?.css}}`})}
`;const qa=(a=0)=>{let c=b.nowIndex+a;b.now=JSON.parse(b.history[c]),b.nowIndex=c,M(),n(),o(),l(),r(),s()};const ua=()=>{let a=b.settings;return i`


    <!-- Undo/Redo -->
    <div class=configuration id=undo_redo>

        <button
        data-icon
        title=Undo
        ?disabled=${b.nowIndex==0}
        @click=${qa.bind(void 0,-1)}>
        </button>

        <button
        data-icon
        title=Redo
        ?disabled=${b.nowIndex>=b.history.length-1}
        @click=${qa.bind(void 0,1)}>
        </button>

    </div>


    <!-- Zoom -->
    <div class=configuration id=zoom>

        <button
        data-icon
        title="Zoom Out"
        @click=${x.zoom.bind(void 0,"out")}>
        </button>

        <button
        data-icon
        title="Zoom In"
        @click=${x.zoom.bind(void 0,"in")}>
        </button>

        <label>${"("+Math.round(a.zoom*100)+"%)"}</label>

    </div>
    

    <!-- Toggle Dark Mode -->
    <div class=configuration>

        <button 
        data-icon 
        title=${"You're in "+(a.darkMode?"Dark":"Light")+" Mode"}
        ?aria-pressed=${a.darkMode}
        @click=${x.toggleDarkMode}
        id=dark_mode_toggle>
        </button>

    </div>
    

    <!-- Toggle Advanced UI -->
    <div class=configuration id=advancedUI_toggle>

        <button
        data-icon
        id="advanced_toggle"
        ?aria-pressed=${a.advancedUI}
        title=${(a.advancedUI?"Disable":"Enable")+" Advanced UI"}
        @click=${x.toggleAdvancedUI}>
        </button>

    </div>
    

    <!-- Template Management -->
    <div class=configuration id=manageTemplates>

        <!-- Select Template -->
    ${b.templates.length?i`
        <select 
        title=${"Current Template: "+b.now.selected.template.name} 
        @input=${ka}>

    ${b.templates.map(c=>{let d=JSON.parse(c),e=b.now.selected.template.id==d.id;return i`
            <option 
            ?selected=${e}
            value=${d.id}>
                ${d.name}
            </option>`})}

        </select>

        <!-- Edit Template -->
        <button
        data-icon
        title="Edit Template"
        @click=${u.bind(void 0,"template",!0)}>
        </button>

        `:U}

        <!-- Save New Template -->
        <button
        data-icon
        title="New Template"
        @click=${u.bind(void 0,"template",!1)}>
        </button>

    </div>


    <!-- Print Document -->
    <div class=configuration id=printDocument>
        <button 
        data-icon
        title=Print
        @click=${x.printDocument}>
        </button>
    </div>


    <!-- Import and Export Data -->
    <div class=configuration id=import_export>

        <a 
        class="button primary"
        data-icon
        title="Export Data"
        id=exportData
        .href=${b?.forExport}
        download=${`My Data (${new Date(b.lastSaved).toLocaleDateString()}).json`}
        >
        </a>

        <input
        aria-hidden="true"
        id=importData
        type=file
        accept=.json
        @input=${x.importData}>

        <label 
        data-icon
        title="Import Data"
        class="fileInput secondary"
        for=importData>
        </label>

        <!-- Clear Data -->
        <button
        data-icon
        title="Clear Data"
        class=destructive
        @click=${x.clearData}>
        </button>

    </div>


    <!-- Last Saved -->
    ${b.lastSaved?i`
    <div class=configuration>
            Saved: ${new Date(b.lastSaved).toLocaleTimeString("en-us",{timeStyle:"short"})}
    </div>
    `:U}
    `};const va=(a,c)=>a?(a=="field type"&&(b.now.editing=c?b.now.selected.fieldType:new da()),a=="template"&&(b.now.editing=c?b.now.selected.template:new ea()),i`
    <div class=content>
        
        <div class=heading>
            ${b.now.editing.type} Editor
            <span
            tabindex=0 
            data-tooltip=${"This pane is for renaming or editing your "+b.now.editing.type+"."}>
            </span>
        </div>

        <input 
        name=name 
        @input=${$.updateType} 
        type=text 
        placeholder=${"Name your "+b.now.editing.type+"..."}
        value=${c?b.now.editing.name:""} />
        
        <div class=actions>

            <button 
            @click=${c?u.bind(void 0,null):$.saveNewType.bind(void 0,b.now.editing.type)}>
                Done
            </button>

            ${c?i`
            <button 
            class=remove 
            @click=${$.removeType.bind(void 0,b.now.editing.type)}>
                Delete ${b.now.editing.type}
            </button>`:""}

            <button 
            class=cancel 
            @click=${u.bind(void 0,null)}>
                Cancel
            </button>
            
        </div>

    </div>`):"";const wa=()=>i`

<button 
data-icon
title="Switch to Content Editor" 
@click=${x.switchPane.bind(void 0,"content_editor")}>
</button>

<button
data-icon
title="Switch to Preview"
@click=${x.switchPane.bind(void 0,"preview")}>
</button>

<button
data-icon
title="Switch to Style Editor"
@click=${x.switchPane.bind(void 0,"style_editor")}>
</button>

`;async function l(){O(i`
        <div class=content>
            ${b.now.children.map(a=>ga(a))}
        </div>`,w.previewPane)}async function o(){let a=document.documentElement;a.style.setProperty("--preview_zoom",b.settings.zoom),a.classList.toggle("dark_mode",b.settings.darkMode),a.classList.toggle("advanced",b.settings.advancedUI),O(ua(),w.toolbar)}function s(){O(ta(),w.customStyles)}function u(a,c=!1){w.modal.classList.toggle("open",a),O(va(a,c),w.modal);if(a)try{w.modal.querySelector("input").focus()}catch(d){}a||(b.now.editing={},o(),r(),l())}function r(){O(sa(),w.styleEditorPane);for(let a of w.styleEditorPane.querySelectorAll("code"))a.innerHTML="",a.id.includes("field")&&(a.innerText=b.now.selected.fieldType?.css||""),a.id.includes("global")&&(a.innerText=b.now.selected.globalType?.css||""),B?.formatCSS({target:a})}function n(){O(i`
        <div class=heading>
            Content Editor
            <span tabindex=0
                data-tooltip="This pane is for editing the content of your document. Try nesting content blocks or adding custom fields to a section."></span>
        </div>
        
        ${b.now.children.map((a,c)=>fa(a,b.now,c))}
        `,w.contentEditorPane)}function Ea(){O(wa(),w.mobileNav)}async function ra(a=!1){if(!b.hasChanged&&!a)return;b.templates.map((f,h)=>{let g=JSON.parse(f),m=g.id==b.now.selected.template.id;m&&b.templates.splice(h,1,JSON.stringify(b.now.selected.template))}),localStorage.setItem("State",JSON.stringify(b)),b.history.push(JSON.stringify(b.now)),b.nowIndex=b.history.length-1,b.history.length>250&&b.history.splice(0,1),b.hasChanged=!1,b.lastSaved=new Date().getTime();let c=JSON.stringify(b,(f,h)=>f=="history"?[]:h),d=new Blob([c],{type:"application/json"}),e=URL.createObjectURL(d);b.forExport=e,o()}b.isNewUser&&!b.now.children.length&&(b.now.children.push(new L()),b.now.children[0].fields.push(new ca()),ra(!0));M();n();o();l();r();Ea();s();setInterval(ra,H.saveInterval);document.body.classList.remove("loading");b.isMobile=innerWidth<H.mobileBreakpoint;for(let a of document.querySelectorAll("[data-icon]"))a.setAttribute("aria-hidden",!0);})();
