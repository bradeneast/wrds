(()=>{const ub=new WeakMap(),W=a=>typeof a==="function"&&ub.has(a);const ya=typeof window!=="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,na=(a,c,d=null)=>{for(;c!==d;){const e=c.nextSibling;a.removeChild(c),c=e}};const w={},ba={};const G=`{{lit-${String(Math.random()).slice(2)}}}`,Ba=`<!--${G}-->`,qb=new RegExp(`${G}|${Ba}`),X="$lit$";class nb{constructor(a,c){this.parts=[],this.element=c;const d=[],e=[],f=document.createTreeWalker(c.content,133,null,!1);let i=0,h=-1,l=0;const{strings:q,values:{length:Ca}}=a;for(;l<Ca;){const k=f.nextNode();if(k===null){f.currentNode=e.pop();continue}h++;if(k.nodeType===1){if(k.hasAttributes()){const x=k.attributes,{length:Y}=x;let J=0;for(let y=0;y<Y;y++)rb(x[y].name,X)&&J++;for(;J-- >0;){const y=q[l],Q=pa.exec(y)[2],K=Q.toLowerCase()+X,L=k.getAttribute(K);k.removeAttribute(K);const C=L.split(qb);this.parts.push({type:"attribute",index:h,name:Q,strings:C}),l+=C.length-1}}k.tagName==="TEMPLATE"&&(e.push(k),f.currentNode=k.content)}else if(k.nodeType===3){const x=k.data;if(x.indexOf(G)>=0){const Y=k.parentNode,J=x.split(qb),y=J.length-1;for(let Q=0;Q<y;Q++){let K,L=J[Q];if(L==="")K=I();else{const C=pa.exec(L);C!==null&&rb(C[2],X)&&(L=L.slice(0,C.index)+C[1]+C[2].slice(0,-X.length)+C[3]),K=document.createTextNode(L)}Y.insertBefore(K,k),this.parts.push({type:"node",index:++h})}J[y]===""?(Y.insertBefore(I(),k),d.push(k)):k.data=J[y],l+=y}}else if(k.nodeType===8)if(k.data===G){const x=k.parentNode;(k.previousSibling===null||h===i)&&(h++,x.insertBefore(I(),k)),i=h,this.parts.push({type:"node",index:h}),k.nextSibling===null?k.data="":(d.push(k),h--),l++}else{let x=-1;for(;(x=k.data.indexOf(G,x+1))!==-1;)this.parts.push({type:"node",index:-1}),l++}}for(const k of d)k.parentNode.removeChild(k)}}const rb=(a,c)=>{const d=a.length-c.length;return d>=0&&a.slice(d)===c},pb=a=>a.index!==-1,I=()=>document.createComment(""),pa=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class za{constructor(a,c,d){this.__parts=[],this.template=a,this.processor=c,this.options=d}update(a){let c=0;for(const d of this.__parts)d!==void 0&&d.setValue(a[c]),c++;for(const d of this.__parts)d!==void 0&&d.commit()}_clone(){const a=ya?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),c=[],d=this.template.parts,e=document.createTreeWalker(a,133,null,!1);let f=0,i=0,h,l=e.nextNode();for(;f<d.length;){h=d[f];if(!pb(h)){this.__parts.push(void 0),f++;continue}for(;i<h.index;)i++,l.nodeName==="TEMPLATE"&&(c.push(l),e.currentNode=l.content),(l=e.nextNode())===null&&(e.currentNode=c.pop(),l=e.nextNode());if(h.type==="node"){const q=this.processor.handleTextExpression(this.options);q.insertAfterNode(l.previousSibling),this.__parts.push(q)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,h.name,h.strings,this.options));f++}return ya&&(document.adoptNode(a),customElements.upgrade(a)),a}}const xb=` ${G} `;class oa{constructor(a,c,d,e){this.strings=a,this.values=c,this.type=d,this.processor=e}getHTML(){const a=this.strings.length-1;let c="",d=!1;for(let e=0;e<a;e++){const f=this.strings[e],i=f.lastIndexOf("<!--");d=(i>-1||d)&&f.indexOf("-->",i+1)===-1;const h=pa.exec(f);h===null?c+=f+(d?xb:Ba):c+=f.substr(0,h.index)+h[1]+h[2]+X+h[3]+G}return c+=this.strings[a],c}getTemplateElement(){const a=document.createElement("template");return a.innerHTML=this.getHTML(),a}}const Aa=a=>a===null||!(typeof a==="object"||typeof a==="function"),ib=a=>Array.isArray(a)||!!(a&&a[Symbol.iterator]);class xa{constructor(a,c,d){this.dirty=!0,this.element=a,this.name=c,this.strings=d,this.parts=[];for(let e=0;e<d.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new jb(this)}_getValue(){const a=this.strings,c=a.length-1;let d="";for(let e=0;e<c;e++){d+=a[e];const f=this.parts[e];if(f!==void 0){const i=f.value;if(Aa(i)||!ib(i))d+=typeof i==="string"?i:String(i);else for(const h of i)d+=typeof h==="string"?h:String(h)}}return d+=a[c],d}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class jb{constructor(a){this.value=void 0,this.committer=a}setValue(a){a!==w&&(!Aa(a)||a!==this.value)&&(this.value=a,W(a)||(this.committer.dirty=!0))}commit(){for(;W(this.value);){const a=this.value;this.value=w,a(this)}if(this.value===w)return;this.committer.commit()}}class ca{constructor(a){this.value=void 0,this.__pendingValue=void 0,this.options=a}appendInto(a){this.startNode=a.appendChild(I()),this.endNode=a.appendChild(I())}insertAfterNode(a){this.startNode=a,this.endNode=a.nextSibling}appendIntoPart(a){a.__insert(this.startNode=I()),a.__insert(this.endNode=I())}insertAfterPart(a){a.__insert(this.startNode=I()),this.endNode=a.endNode,a.endNode=this.startNode}setValue(a){this.__pendingValue=a}commit(){if(this.startNode.parentNode===null)return;for(;W(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=w,c(this)}const a=this.__pendingValue;if(a===w)return;Aa(a)?a!==this.value&&this.__commitText(a):a instanceof oa?this.__commitTemplateResult(a):a instanceof Node?this.__commitNode(a):ib(a)?this.__commitIterable(a):a===ba?(this.value=ba,this.clear()):this.__commitText(a)}__insert(a){this.endNode.parentNode.insertBefore(a,this.endNode)}__commitNode(a){if(this.value===a)return;this.clear(),this.__insert(a),this.value=a}__commitText(a){const c=this.startNode.nextSibling;a=a==null?"":a;const d=typeof a==="string"?a:String(a);c===this.endNode.previousSibling&&c.nodeType===3?c.data=d:this.__commitNode(document.createTextNode(d)),this.value=a}__commitTemplateResult(a){const c=this.options.templateFactory(a);if(this.value instanceof za&&this.value.template===c)this.value.update(a.values);else{const d=new za(c,a.processor,this.options),e=d._clone();d.update(a.values),this.__commitNode(e),this.value=d}}__commitIterable(a){Array.isArray(this.value)||(this.value=[],this.clear());const c=this.value;let d=0,e;for(const f of a)e=c[d],e===void 0&&(e=new ca(this.options),c.push(e),d===0?e.appendIntoPart(this):e.insertAfterPart(c[d-1])),e.setValue(f),e.commit(),d++;d<c.length&&(c.length=d,this.clear(e&&e.endNode))}clear(a=this.startNode){na(this.startNode.parentNode,a.nextSibling,this.endNode)}}class eb{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0;if(d.length!==2||d[0]!==""||d[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=a,this.name=c,this.strings=d}setValue(a){this.__pendingValue=a}commit(){for(;W(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=w,c(this)}if(this.__pendingValue===w)return;const a=!!this.__pendingValue;this.value!==a&&(a?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=a),this.__pendingValue=w}}class gb extends xa{constructor(a,c,d){super(a,c,d);this.single=d.length===2&&d[0]===""&&d[1]===""}_createPart(){return new vb(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class vb extends jb{}let kb=!1;(()=>{try{const a={get capture(){return kb=!0,!1}};window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch(a){}})();class fb{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0,this.element=a,this.eventName=c,this.eventContext=d,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(a){this.__pendingValue=a}commit(){for(;W(this.__pendingValue);){const f=this.__pendingValue;this.__pendingValue=w,f(this)}if(this.__pendingValue===w)return;const a=this.__pendingValue,c=this.value,d=a==null||c!=null&&(a.capture!==c.capture||a.once!==c.once||a.passive!==c.passive),e=a!=null&&(c==null||d);d&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),e&&(this.__options=wb(a),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=a,this.__pendingValue=w}handleEvent(a){typeof this.value==="function"?this.value.call(this.eventContext||this.element,a):this.value.handleEvent(a)}}const wb=a=>a&&(kb?{capture:a.capture,passive:a.passive,once:a.once}:a.capture);class tb{handleAttributeExpressions(a,c,d,e){const f=c[0];if(f==="."){const h=new gb(a,c.slice(1),d);return h.parts}if(f==="@")return[new fb(a,c.slice(1),e.eventContext)];if(f==="?")return[new eb(a,c.slice(1),d)];const i=new xa(a,c,d);return i.parts}handleTextExpression(a){return new ca(a)}}const hb=new tb();function lb(a){let c=ob.get(a.type);c===void 0&&(c={stringsArray:new WeakMap(),keyString:new Map()},ob.set(a.type,c));let d=c.stringsArray.get(a.strings);if(d!==void 0)return d;const e=a.strings.join(G);return d=c.keyString.get(e),d===void 0&&(d=new nb(a,a.getTemplateElement()),c.keyString.set(e,d)),c.stringsArray.set(a.strings,d),d}const ob=new Map();const mb=new WeakMap(),R=(a,c,d)=>{let e=mb.get(c);e===void 0&&(na(c,c.firstChild),mb.set(c,e=new ca(Object.assign({templateFactory:lb},d))),e.appendInto(c)),e.setValue(a),e.commit()};typeof window!=="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const j=(a,...c)=>new oa(a,c,"html",hb);let u=a=>document.getElementById(a),p=a=>parseInt(a.closest("section").id),U=a=>parseInt(a.closest(".field").id),_=()=>Math.round(new Date().getTime()*Math.random()),$=a=>a.replace(/\W+|[-_]/g,"-");function*B(a,c){for(let d of a)yield{section:d,parent:c},d.children&&(yield*B(d.children,d))}function F(a){let c;for(let{section:d,parent:e}of B(b.now.children))if(d.id==a){c=d;break}return c}function ma(a){let c=a.closest("section"),d=c.getAttribute("data-section-depth");return parseInt(d)}function ia(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d-1,0,f),t(),n(),b.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveUp`)?.focus()}function ha(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d+1,0,f),t(),n(),b.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveDown`)?.focus()}function N(){b.now.fieldTypes=b.now.selected.template.fieldTypes||[],b.now.globalTypes=b.now.selected.template.globalTypes||b.now.globalTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{},b.now.selected.globalType=b.now.globalTypes?.[0]||{};for(let{section:a,parent:c}of B(b.now.children)){if(!a.fields.length)continue;a.fields.map(d=>{d.type=b.now.fieldTypes.find(e=>e.id==d.type?.id)||b.now.fieldTypes?.[0]})}}class M{constructor(a=0){this.id=_(),this.depth=a,this.text="",this.html="",this.children=[],this.fields=[]}}class Ea{constructor(){this.id=_(),this.value="",this.type=0}}class S{constructor(a){this.id=_(),this.name=a,this.css=""}}class Fa{constructor(a){this.id=_(),this.name=a}}class da extends Fa{constructor(a){super(a);this.type="field type",this.css=""}}class ea extends Fa{constructor(a){super(a);this.type="template",this.fieldTypes=[],this.globalTypes=[]}}const r=["Chapter","Section","Block"],O={h1:"Lvl 1 Heading",h2:"Lvl 2 Heading",h3:"Lvl 3 Heading",h4:"Lvl 4 Heading",h5:"Lvl 5 Heading",h6:"Lvl 6 Heading",hr:"Horizontal Rules",p:"Paragraph",blockquote:"Block Quote",ul:"Unordered List",ol:"Ordered List",li:"List Item",a:"Link",strong:"Bolded Text",em:"Italic Text",code:"Code",img:"Image"},v={previewPane:u("preview"),toolbar:u("toolbar"),contentEditorPane:u("content_editor"),styleEditorPane:u("style_editor"),modal:u("modal"),customStyles:u("custom_styles"),walkThroughDialogue:u("walkthrough_dialogue"),mobileNav:u("mobile_nav")},H={throttle:60,mobileBreakpoint:960,saveInterval:2000,zoom:{min:.5,max:2,interval:.1}};let Ga;try{Ga=JSON.parse(localStorage.getItem("State"))}catch(a){console.log("No previous data found.")}const b=Ga||{now:{children:[],fieldTypes:[],globalTypes:r.map(a=>new S(a)).concat(Object.values(O).map(a=>new S(a))),selected:{fieldType:{},globalType:{},template:{}},editing:{}},nowIndex:0,settings:{zoom:1,darkMode:!1,advancedUI:!1,messagesShown:!1},walkthroughIndex:0,history:[],templates:[],hasChanged:!1,isNewUser:!0,isMobile:innerWidth<=H.mobileBreakpoint,lastSaved:new Date(),forExport:""};const Ya=a=>{let c=p(a.target),d=ma(a.target),e;for(let{section:f,parent:i}of B(b.now.children,b.now))if(f.id==c){let h=new M(d);i.children.push(h),e=h.id;break}b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Za=a=>{let c=p(a.target),d=ma(a.target),e;for(let{section:f,parent:i}of B(b.now.children,b.now))if(f.id==c){let h=new M(d+1);f.children.unshift(h),e=h.id;break}b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const _a=a=>{let c=p(a.target);for(let{section:d,parent:e}of B(b.now.children,b.now)){if(d.id!=c)continue;e.children=e.children.filter(f=>f!=d)}b.hasChanged=!0,n(),t()};const $a=a=>{let c=p(a.target),d=F(c);d.text=a.target.value,b.hasChanged=!0,n()};const T={addSiblingSection:Ya,addChildSection:Za,removeSection:_a,updateSection:$a};const Na=a=>{let c=p(a.target),d=F(c),e=new Ea();e.type=b.now.fieldTypes[0],d.fields.push(e),b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e.id}"] input`)?.focus()};const Oa=a=>{let c=p(a.target),d=F(c),e=U(a.target);d.fields=d.fields.filter(f=>f.id!=e),b.hasChanged=!0,t(),n()};const Pa=a=>{let c=p(a.target),d=F(c),e=U(a.target),f=d.fields.find(i=>i.id==e);f.value=a.target.value,b.hasChanged=!0,n()};const Qa=a=>{let c=a.target.value,d=U(a.target),e=p(a.target),f=F(e),i=f.fields.find(h=>h.id==d);i.type=b.now.fieldTypes.find(h=>h.id==c),b.hasChanged=!0,n()};const P={addField:Na,removeField:Oa,updateFieldValue:Pa,updateFieldType:Qa};const ab=a=>{let c=a.target.textContent||"";a.target.id.includes("global")&&(b.now.selected.globalType.css=c,b.hasChanged=!0),a.target.id.includes("field")&&(b.now.selected.fieldType.css=c,b.hasChanged=!0),wa()};const V=a=>{let c=a.target||a,d=(e,f)=>`<span class="token ${f}">${e}</span>`;c.innerHTML=c.innerText.replace(/\n/g,"").replace(/;/g,d(";","newline")).replace(/[,:](?!\s)/g,e=>e+" ")};const bb=a=>{let c=a.target.value,d=u("field_type_styles"),e=b.now.fieldTypes.find(f=>f.id==c);if(e)e.css||(e.css=""),b.now.selected.fieldType=e;else{let f={id:c,css:""};b.now.fieldTypes.push(f),b.now.selected.fieldType=f}d.innerHTML=b.now.selected.fieldType.css,V(d),b.hasChanged=!0,n()};const cb=a=>{let c=u("global_type_styles"),d=a.target.value,e=b.now.globalTypes.find(f=>f.name==d);if(e)e.css||(e.css=""),b.now.selected.globalType=e;else{let f={id:d,css:""};b.now.globalTypes.push(f),b.now.selected.globalType=f}c.innerHTML=b.now.selected.globalType.css,V(c),b.hasChanged=!0,n()};const A={updateStyles:ab,updateCurrentFieldType:bb,updateCurrentGlobalType:cb,formatCSS:V};const Ja=a=>{if(a=="template"){b.templates=b.templates.filter(c=>JSON.parse(c).id!=b.now.selected.template.id);try{b.now.selected.template=JSON.parse(b.templates?.[0])||{}}catch(c){}}a=="field type"&&(b.now.fieldTypes=b.now.fieldTypes.filter(c=>c.id!=b.now.selected.fieldType.id),b.now.selected.template.fieldTypes=b.now.fieldTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{}),b.now.editing={},b.hasChanged=!0,o(),s(null)};const Ka=a=>{b.now.editing[a.target.name]=a.target.value,b.now.editing?.type=="template"&&b.templates.map((c,d)=>{let e=JSON.parse(c),f=e.id==b.now.editing.id;f&&b.templates.splice(d,1,JSON.stringify(b.now.editing))}),b.hasChanged=!0,o()};const Ma=()=>{b.now.selected.fieldType=b.now.fieldTypes[b.now.fieldTypes.length-1],b.now.selected.template.fieldTypes=b.now.fieldTypes;if(b.now.fieldTypes.length==1)for(let{section:a,parent:c}of B(b.now.children))a.fields.map(d=>d.type=b.now.fieldTypes[0])};const La=a=>{b.now.editing.name=b.now.editing.name.trim();if(!b.now.editing.name.length){s(null);return}a=="field type"&&(b.now.fieldTypes.push(new da(b.now.editing.name)),Ma(),v.styleEditorPane.querySelector("code")?.focus());if(a=="template"){let c=new ea(b.now.editing.name);c.fieldTypes=b.now.fieldTypes,c.globalTypes=b.now.globalTypes,b.templates.push(JSON.stringify(c)),b.now.selected.template=c}b.now.editing={},b.hasChanged=!0,o(),s(null)};const aa={removeType:Ja,updateType:Ka,saveNewType:La};const Ra=a=>{let c=b.settings.darkMode;document.documentElement.classList.toggle("dark_mode",!c),b.settings.darkMode=!c,b.hasChanged=!0,D()};const Sa=a=>{let c=b.settings.advancedUI;document.documentElement.classList.toggle("advanced",!c),b.settings.advancedUI=!c,b.hasChanged=!0,D()};const la=a=>{if(!confirm("Are you sure you want to load this template?"))return;for(let c of b.templates){let d=JSON.parse(c);if(d.id==a.target.value){b.now.selected.template=d,N(),o(),b.hasChanged=!0;break}}};const Ta=a=>window.print();const Ua=a=>{let c=a.target.files[0],d=new FileReader();d.onerror=function(){console.error(this.error)},d.onload=function(){let e=JSON.parse(this.result);Object.keys(b).map(f=>b[f]=e[f]),N(),o()},document.body.classList.add("importing"),d.readAsText(c)};const Va=a=>{b.now.children=[new M()],b.now.fieldTypes=[],b.now.globalTypes=r.map(c=>new S(c)).concat(Object.values(O).map(c=>new S(c))),b.now.editing={},b.now.selected={fieldType:{},globalType:{},template:{}},b.templates=[],o(),b.hasChanged=!0};const Wa=a=>{document.body.setAttribute("data-selected-pane",a)};const Xa=(a="")=>{let c=a.toLowerCase(),d=b.settings.zoom;c=="out"&&d>H.zoom.min&&(d=d-H.zoom.interval),c=="in"&&d<H.zoom.max&&(d=d+H.zoom.interval),d!=b.settings.zoom&&(b.settings.zoom=d,b.hasChanged=!0,D())};const E={toggleDarkMode:Ra,toggleAdvancedUI:Sa,loadTemplate:la,printDocument:Ta,importData:Ua,clearData:Va,switchPane:Wa,zoom:Xa};const ja=({global:a=!1,field:c={}}={})=>{if(!b.now.fieldTypes?.length)return;let d=a?b.now.selected.fieldType?.id:c?.type?.id;return j`
    <select name=type @input=${a?A.updateCurrentFieldType:P.updateFieldType}>

        ${b.now.fieldTypes.map(e=>j`
            <option value=${e.id} ?selected=${e.id==d}>
                ${e.name}
            </option>
        `)}

    </select>`};const Ha=(a,c,d)=>j`
<div 
class=field 
id=${a.id}>

    <input 
    placeholder="Field value..."
    type=text 
    .value=${a.value} 
    @input=${P.updateFieldValue} />

    ${ja({field:a})}

    <button 
    @click=${P.removeField} 
    class=remove>
        Remove
    </button>

    <button
    data-icon
    @click=${ha.bind(void 0,c,"fields",d)}
    ?disabled=${d>=c.fields.length-1}
    class="move moveDown">
    </button>

    <button
    data-icon
    @click=${ia.bind(void 0,c,"fields",d)}
    ?disabled=${!d} 
    class="move moveUp">
    </button>

</div>`;function fa(a,c,d){let e=b.now.children.length,f=a.depth,i=f==r.length-1;return j`
    <section 
    id=${a.id} 
    data-section-depth=${a.depth}>

        <div class=fields>
            ${a.fields.map((h,l)=>Ha(h,a,l))}
        </div>

        <textarea 
        id="${a.id}-text"
        placeholder=${"Write something for this "+r[f].toLowerCase()+"..."} 
        @input=${T.updateSection} 
        .value=${a.text}>
        </textarea>

        <div class=actions>

            <button 
            data-icon=add_another
            title=${"Add "+r[f]}
            @click=${T.addSiblingSection}>
            </button>

            ${i?"":j`
            <button 
            data-icon=add_sub
            title=${"Add "+r[f+1]}
            @click=${T.addChildSection}>
            </button>`}

            <button 
            class=add
            data-icon
            title="Add Field"
            @click=${P.addField}>
            </button>

            ${e>1||f?j`
            <button 
            class=remove
            @click=${T.removeSection}>
            Remove
            </button>`:""}

            ${c.children.length>1?j`

            <button 
            class="move moveDown" 
            data-icon
            title="Move Down"
            ?disabled=${d>=c.children.length-1} 
            @click=${ha.bind(this,c,"children",d)}>
            </button>

            <button 
            class="move moveUp"
            data-icon
            title="Move Up"
            ?disabled=${!d} 
            @click=${ia.bind(this,c,"children",d)}>
            </button>
            
            `:""}

        </div>

        ${a.children.length?a.children.map((h,l)=>fa(h,a,l)):""}

    </section>`}const ka=a=>{let c={"!":"33","#":"35","&":"38;","(":"40",")":"41","*":"42","+":"43","-":"45",".":"46","<":"60;",">":"62;","[":"91","\\":"92","]":"93",_:"95","`":"96","{":"123","}":"125","~":"126"},d=/(^|\s)(> )+(.|\n)+?(?=$|\n(?!>))/g,e="[0-9]+\\. ",f="[-+*] ",i=g=>"&#"+(c[g]||g),h=g=>g.replace(/[&<>]/g,i),l=g=>g.trim().slice(1,-1),q=(g,m)=>`<${g}>${m}</${g}>`,Ca=g=>{let m=new RegExp(`[^|\\n]${e}`).test(g),z=new RegExp(`(^|\\n)${m?e:f}`),Z=g.split(z).filter(Da=>Da.trim().length);return q(m?"ol":"ul",Z.map(Da=>q("li",Da)).join(""))},k=g=>{g=g.trim();let m=g.indexOf(" ");return q(`h${m}`,g.slice(m).replace(/#+$/,"").trim())},x=g=>{let m=g.trim().split(/\n/);return q(`h${m[1].indexOf("-")>-1?2:1}`,m[0])},Y=g=>{let m=g.slice(1,-1).split("]("),z=m[1].split(/ ["`']/)[1];return`<a href="${m[1]}" ${z?`title="${z}"`:""}>${m[0]}</a>`},J=g=>{let m=g.split(/["`']/),z=m[0].trim().replace(/^<|>$/g,""),Z=m[1];return` <a href="${z}" ${Z?`title="${Z}"`:""}>${z}</a>`},y=g=>{let m=g.slice(2,-1).split("]("),z=m[1].split(/ ["`']/)[1];return`<img src="${m[1]}" ${z?`title="${z}"`:""} alt="${m[0]}">`},Q=g=>{let[m,...z]=g.trim().split(/\n+/),Z=h(z.slice(0,-1).join("\r")).trim();return q("pre",`<code class="language-${m.slice(3)}">${Z}</code>`)},K=g=>(g=q("blockquote",g.replace(/^ *?> /gm,"")),g.replace(d,K)),L=g=>` <a href="${g}">${g.trim()}</a>`,C=g=>q("p",g.trim()),yb=g=>q("strong",g.slice(2,-2)),zb=g=>q("em",l(g)),Ab=g=>q("del",l(g)),Bb=g=>q("code",h(l(g)));return a.replace(/\r+/g,`
`).replace(/\\[-*_\\`#~+.!(){}[\]]/g,g=>i(g.slice(1))).replace(/(^|\n).+?\n[-=]+(?=$|\n)/g,x).replace(/(^|\n)#+? (.|\n)+?(?=$|\n)/g,k).replace(/(^|\n)([-*_] ?){3,}(?=$|\n)/g,"<hr>").replace(/(^|\n)([0-9]+\.|[-+*]) (.|\n)+?(?=$|[\s\n]{3,})/g,Ca).replace(d,K).replace(/(^|\n)```(.|\n)+?```(?=$|\n)/g,Q).replace(/  (\n|$)/g,"<br>").replace(/!\[.+?\]\(.+?\)/g,y).replace(/\[.+?\]\(.+?\)/g,Y).replace(/<(https?:\/\/|www).+?>( (".+?")|('.+?'))?(?=$|\n| )/g,J).replace(/(^|\n| )(https?:\/\/|www)(.+?)+?(?=$|\n| )/g,L).replace(/\s[*_](?=\s)/g,g=>g.slice(0,1)+i(g.slice(1))).replace(/[*_]{2}.+?[*_]{2}/gm,yb).replace(/[*_].+?[*_]/gm,zb).replace(/~.+?~/gm,Ab).replace(/`.+?`/gm,Bb).replace(/(^|\n\n+)(?!<[huol]).+?(?=$|\n\n+)/gi,C)};const Ia=a=>{let c=b.now.fieldTypes.find(e=>e.id==a?.type?.id),d=document.createElement("div");return d.innerHTML=ka(a.value),/<p>/.test(d.innerHTML)&&(d.innerHTML=d.firstElementChild.innerHTML),j`
    <div class=${$(c?.name||"")}>
        ${d}
    </div>`};function ga(a){let c=document.createElement("div");return c.classList.add("content"),c.innerHTML=ka(a.text),j`
    <section class=${r[a.depth]}>
    
        ${a.fields.map(d=>Ia(d))}
    
        ${a.text.length?c:""}
    
        ${a.children.map(d=>ga(d))}
    
    </section>`}const sa=()=>j`

<div class="heading">
    Style Editor
    <span tabindex="0" data-tooltip="This pane is for editing your document's styles. Apply valid CSS rules to any custom field type or global element."></span>
</div>

<section id=manageFieldTypes>

    <div class=actions>

        <label>Field Styles</label>

        ${ja({global:!0})}

        ${b.now.fieldTypes?.length?j`
        <button 
        data-icon
        title="Edit Field Type"
        @click=${s.bind(void 0,"field type",!0)}>
        </button>`:""}

        <button 
        class=add 
        data-icon
        title="New Field Type"
        @click=${s.bind(void 0,"field type",!1)}>
        </button>
        
    </div>

    <code 
    spellcheck=false
    id=field_type_styles
    class=language-css 
    contenteditable=true 
    @focusout=${A.formatCSS}
    @keyup=${A.updateStyles}></code>
    
</section>


<section id=manageGlobalTypes>

    <div class=actions>

        <label>Global Styles</label>

        <select id=global-style-select @input=${A.updateCurrentGlobalType}>

            <optgroup label=Layout>
            ${r.map(a=>j`
                <option
                value=${a}
                ?selected=${a==b.now.selected.globalType?.name}>
                    ${a}s
                </option>
            `)}
            </optgroup>

            <optgroup label=Elements>
                ${Object.values(O).map(a=>j`
                    <option 
                    label=${a}
                    value=${a}
                    ?selected=${a==b.now.selected.globalType?.name}>
                        ${a}s
                    </option>
                `)}
            </optgroup>
        </select>

    </div>

    <code
    spellcheck=false
    id=global_type_styles
    class=language-css
    contenteditable=true
    @focusout=${A.formatCSS}
    @keyup=${A.updateStyles}></code>

</section>
`;const ta=()=>j`

${b.now.fieldTypes.map(a=>`#preview .${$(a.name).trim()}{${a.css}}`)}

${r.map(a=>{let c=b.now.globalTypes.find(d=>d.name==a);return`#preview .${$(a).trim()}{${c?.css}}`})}

${Object.keys(O).map(a=>{let c=O[a],d=b.now.globalTypes.find(e=>e.name==c);return`#preview ${a} {${d?.css}}`})}
`;const qa=(a=0)=>{let c=b.nowIndex+a;b.now=JSON.parse(b.history[c]),b.nowIndex=c,N(),o()};const ua=()=>{let a=b.settings;return j`
    <!-- Undo/Redo -->
    <div class=configuration id=undo_redo>
        <button data-icon title=Undo ?disabled=${b.nowIndex==0} @click=${qa.bind(void 0,-1)}>
        </button>
        <button data-icon title=Redo ?disabled=${b.nowIndex>=b.history.length-1}
            @click=${qa.bind(void 0,1)}>
        </button>
    </div>
    
    <!-- Zoom -->
    <div class=configuration id=zoom>
        <button data-icon title="Zoom Out" @click=${E.zoom.bind(void 0,"out")}>
        </button>
        <button data-icon title="Zoom In" @click=${E.zoom.bind(void 0,"in")}>
        </button>
        <label>${"("+Math.round(a.zoom*100)+"%)"}</label>
    </div>
    
    <!-- Toggle Dark Mode -->
    <div class=configuration>
        <button data-icon title=${"You're in "+(a.darkMode?"Dark":"Light")+" Mode"}
            ?aria-pressed=${a.darkMode} @click=${E.toggleDarkMode} id=dark_mode_toggle>
        </button>
    </div>
    
    <!-- Toggle Advanced UI -->
    <div class=configuration id=advancedUI_toggle>
        <button data-icon id="advanced_toggle" ?aria-pressed=${a.advancedUI} title=${(a.advancedUI?"Disable":"Enable")+" Advanced UI"} @click=${E.toggleAdvancedUI}>
        </button>
    </div>
    
    <!-- Template Management -->
    <div class=configuration id=manageTemplates>
        <!-- Select Template -->
        ${b.templates.length?j`<select title=${"Current Template: "+b.now.selected.template.name} @input=${la}>
                ${b.templates.map(c=>{let d=JSON.parse(c),e=b.now.selected.template.id==d.id;return j`<option ?selected=${e} value=${d.id}>${d.name}</option>`})}
            </select>
            <button data-icon title=" Edit Template" @click=${s.bind(void 0,"template",!0)}></button>`:ba}
    
        <!-- Save New Template -->
        <button data-icon title="New Template" @click=${s.bind(void 0,"template",!1)}></button>
    </div>
    
    <!-- Print Document -->
    <div class=configuration id=printDocument>
        <button data-icon title=Print @click=${E.printDocument}>
        </button>
    </div>
    
    <!-- Import and Export Data -->
    <div class=configuration id=import_export>
        <input aria-hidden="true" id=importData type=file accept=.json @input=${E.importData}>
        <label data-icon title="Import Data" class="fileInput secondary" for=importData>
        </label>
        <a class="button primary" data-icon title="Export Data" id=exportData .href=${b?.forExport} download=${`My Data\r
            (${new Date(b.lastSaved).toLocaleDateString()}).json`}>
        </a>
        <!-- Clear Data -->
        <button data-icon title="Clear Data" class=destructive @click=${E.clearData}>
        </button>
    </div>
    
    <!-- Last Saved -->
    <div class=configuration id=savedIndicator>
        Saved: ${new Date(b?.lastSaved||"").toLocaleTimeString("en-us",{timeStyle:"short"})}
    </div>`};const va=(a,c)=>a?(a=="field type"&&(b.now.editing=c?b.now.selected.fieldType:new da()),a=="template"&&(b.now.editing=c?b.now.selected.template:new ea()),j`
    <div class=content>
        
        <div class=heading>
            ${b.now.editing.type} Editor
            <span
            tabindex=0 
            data-tooltip=${"This pane is for renaming or editing your "+b.now.editing.type+"."}>
            </span>
        </div>

        <input 
        name=name 
        @input=${aa.updateType} 
        type=text 
        placeholder=${"Name your "+b.now.editing.type+"..."}
        value=${c?b.now.editing.name:""} />
        
        <div class=actions>

            <button 
            @click=${c?s.bind(void 0,null):aa.saveNewType.bind(void 0,b.now.editing.type)}>
                Done
            </button>

            ${c?j`
            <button 
            class=remove 
            @click=${aa.removeType.bind(void 0,b.now.editing.type)}>
                Delete ${b.now.editing.type}
            </button>`:""}

            <button 
            class=cancel 
            @click=${s.bind(void 0,null)}>
                Cancel
            </button>
            
        </div>

    </div>`):"";async function o(){t(),D(),n(),db(),wa()}async function n(){R(j`
        <div class=content>
            ${b.now.children.map(a=>ga(a))}
        </div>`,v.previewPane)}async function D(){let a=document.documentElement;a.style.setProperty("--preview_zoom",b.settings.zoom),a.classList.toggle("dark_mode",b.settings.darkMode),a.classList.toggle("advanced",b.settings.advancedUI),R(ua(),v.toolbar)}function wa(){R(ta(),v.customStyles)}function s(a,c=!1){v.modal.classList.toggle("open",a),R(va(a,c),v.modal);if(a)try{v.modal.querySelector("input").focus()}catch(d){}a||(b.now.editing={},D(),db(),n())}function db(){R(sa(),v.styleEditorPane);for(let a of v.styleEditorPane.querySelectorAll("code"))a.innerHTML="",a.id.includes("field")&&(a.innerText=b.now.selected.fieldType?.css||""),a.id.includes("global")&&(a.innerText=b.now.selected.globalType?.css||""),A?.formatCSS({target:a})}function t(){R(j`
        <div class=heading>
            Content Editor
            <span tabindex=0
                data-tooltip="This pane is for editing the content of your document. Try nesting content blocks or adding custom fields to a section."></span>
        </div>
        
        ${b.now.children.map((a,c)=>fa(a,b.now,c))}
        `,v.contentEditorPane)}async function ra(a=!1){if(!b.hasChanged&&!a)return;b.templates.map((f,i)=>{let h=JSON.parse(f),l=h.id==b.now.selected.template.id;l&&b.templates.splice(i,1,JSON.stringify(b.now.selected.template))}),localStorage.setItem("State",JSON.stringify(b)),b.history.push(JSON.stringify(b.now)),b.nowIndex=b.history.length-1,b.history.length>250&&b.history.splice(0,1),b.hasChanged=!1,b.lastSaved=new Date().getTime();let c=JSON.stringify(b,(f,i)=>{switch(f){case"history":return[];case"settings":return{}}}),d=new Blob([c],{type:"application/json"}),e=URL.createObjectURL(d);b.forExport=e,D()}b.isNewUser&&!b.now.children.length&&(b.now.children.push(new M()),ra(!0));N();o();setInterval(ra,H.saveInterval);document.body.classList.remove("loading");b.isMobile=innerWidth<H.mobileBreakpoint;for(let a of document.querySelectorAll("[data-icon]"))a.setAttribute("aria-hidden",!0);})();
