(()=>{const qb=new WeakMap(),V=a=>typeof a==="function"&&qb.has(a);const va=typeof window!=="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,ka=(a,b,d=null)=>{for(;b!==d;){const e=b.nextSibling;a.removeChild(b),b=e}};const v={},wa={};const E=`{{lit-${String(Math.random()).slice(2)}}}`,za=`<!--${E}-->`,lb=new RegExp(`${E}|${za}`),W="$lit$";class ib{constructor(a,b){this.parts=[],this.element=b;const d=[],e=[],f=document.createTreeWalker(b.content,133,null,!1);let j=0,h=-1,m=0;const{strings:p,values:{length:Aa}}=a;for(;m<Aa;){const k=f.nextNode();if(k===null){f.currentNode=e.pop();continue}h++;if(k.nodeType===1){if(k.hasAttributes()){const w=k.attributes,{length:X}=w;let G=0;for(let x=0;x<X;x++)mb(w[x].name,W)&&G++;for(;G-- >0;){const x=p[m],O=ma.exec(x)[2],H=O.toLowerCase()+W,I=k.getAttribute(H);k.removeAttribute(H);const C=I.split(lb);this.parts.push({type:"attribute",index:h,name:O,strings:C}),m+=C.length-1}}k.tagName==="TEMPLATE"&&(e.push(k),f.currentNode=k.content)}else if(k.nodeType===3){const w=k.data;if(w.indexOf(E)>=0){const X=k.parentNode,G=w.split(lb),x=G.length-1;for(let O=0;O<x;O++){let H,I=G[O];if(I==="")H=F();else{const C=ma.exec(I);C!==null&&mb(C[2],W)&&(I=I.slice(0,C.index)+C[1]+C[2].slice(0,-W.length)+C[3]),H=document.createTextNode(I)}X.insertBefore(H,k),this.parts.push({type:"node",index:++h})}G[x]===""?(X.insertBefore(F(),k),d.push(k)):k.data=G[x],m+=x}}else if(k.nodeType===8)if(k.data===E){const w=k.parentNode;(k.previousSibling===null||h===j)&&(h++,w.insertBefore(F(),k)),j=h,this.parts.push({type:"node",index:h}),k.nextSibling===null?k.data="":(d.push(k),h--),m++}else{let w=-1;for(;(w=k.data.indexOf(E,w+1))!==-1;)this.parts.push({type:"node",index:-1}),m++}}for(const k of d)k.parentNode.removeChild(k)}}const mb=(a,b)=>{const d=a.length-b.length;return d>=0&&a.slice(d)===b},kb=a=>a.index!==-1,F=()=>document.createComment(""),ma=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class xa{constructor(a,b,d){this.__parts=[],this.template=a,this.processor=b,this.options=d}update(a){let b=0;for(const d of this.__parts)d!==void 0&&d.setValue(a[b]),b++;for(const d of this.__parts)d!==void 0&&d.commit()}_clone(){const a=va?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),b=[],d=this.template.parts,e=document.createTreeWalker(a,133,null,!1);let f=0,j=0,h,m=e.nextNode();for(;f<d.length;){h=d[f];if(!kb(h)){this.__parts.push(void 0),f++;continue}for(;j<h.index;)j++,m.nodeName==="TEMPLATE"&&(b.push(m),e.currentNode=m.content),(m=e.nextNode())===null&&(e.currentNode=b.pop(),m=e.nextNode());if(h.type==="node"){const p=this.processor.handleTextExpression(this.options);p.insertAfterNode(m.previousSibling),this.__parts.push(p)}else this.__parts.push(...this.processor.handleAttributeExpressions(m,h.name,h.strings,this.options));f++}return va&&(document.adoptNode(a),customElements.upgrade(a)),a}}const tb=` ${E} `;class la{constructor(a,b,d,e){this.strings=a,this.values=b,this.type=d,this.processor=e}getHTML(){const a=this.strings.length-1;let b="",d=!1;for(let e=0;e<a;e++){const f=this.strings[e],j=f.lastIndexOf("<!--");d=(j>-1||d)&&f.indexOf("-->",j+1)===-1;const h=ma.exec(f);h===null?b+=f+(d?tb:za):b+=f.substr(0,h.index)+h[1]+h[2]+W+h[3]+E}return b+=this.strings[a],b}getTemplateElement(){const a=document.createElement("template");return a.innerHTML=this.getHTML(),a}}const ya=a=>a===null||!(typeof a==="object"||typeof a==="function"),db=a=>Array.isArray(a)||!!(a&&a[Symbol.iterator]);class ua{constructor(a,b,d){this.dirty=!0,this.element=a,this.name=b,this.strings=d,this.parts=[];for(let e=0;e<d.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new eb(this)}_getValue(){const a=this.strings,b=a.length-1;let d="";for(let e=0;e<b;e++){d+=a[e];const f=this.parts[e];if(f!==void 0){const j=f.value;if(ya(j)||!db(j))d+=typeof j==="string"?j:String(j);else for(const h of j)d+=typeof h==="string"?h:String(h)}}return d+=a[b],d}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class eb{constructor(a){this.value=void 0,this.committer=a}setValue(a){a!==v&&(!ya(a)||a!==this.value)&&(this.value=a,V(a)||(this.committer.dirty=!0))}commit(){for(;V(this.value);){const a=this.value;this.value=v,a(this)}if(this.value===v)return;this.committer.commit()}}class aa{constructor(a){this.value=void 0,this.__pendingValue=void 0,this.options=a}appendInto(a){this.startNode=a.appendChild(F()),this.endNode=a.appendChild(F())}insertAfterNode(a){this.startNode=a,this.endNode=a.nextSibling}appendIntoPart(a){a.__insert(this.startNode=F()),a.__insert(this.endNode=F())}insertAfterPart(a){a.__insert(this.startNode=F()),this.endNode=a.endNode,a.endNode=this.startNode}setValue(a){this.__pendingValue=a}commit(){if(this.startNode.parentNode===null)return;for(;V(this.__pendingValue);){const b=this.__pendingValue;this.__pendingValue=v,b(this)}const a=this.__pendingValue;if(a===v)return;ya(a)?a!==this.value&&this.__commitText(a):a instanceof la?this.__commitTemplateResult(a):a instanceof Node?this.__commitNode(a):db(a)?this.__commitIterable(a):a===wa?(this.value=wa,this.clear()):this.__commitText(a)}__insert(a){this.endNode.parentNode.insertBefore(a,this.endNode)}__commitNode(a){if(this.value===a)return;this.clear(),this.__insert(a),this.value=a}__commitText(a){const b=this.startNode.nextSibling;a=a==null?"":a;const d=typeof a==="string"?a:String(a);b===this.endNode.previousSibling&&b.nodeType===3?b.data=d:this.__commitNode(document.createTextNode(d)),this.value=a}__commitTemplateResult(a){const b=this.options.templateFactory(a);if(this.value instanceof xa&&this.value.template===b)this.value.update(a.values);else{const d=new xa(b,a.processor,this.options),e=d._clone();d.update(a.values),this.__commitNode(e),this.value=d}}__commitIterable(a){Array.isArray(this.value)||(this.value=[],this.clear());const b=this.value;let d=0,e;for(const f of a)e=b[d],e===void 0&&(e=new aa(this.options),b.push(e),d===0?e.appendIntoPart(this):e.insertAfterPart(b[d-1])),e.setValue(f),e.commit(),d++;d<b.length&&(b.length=d,this.clear(e&&e.endNode))}clear(a=this.startNode){ka(this.startNode.parentNode,a.nextSibling,this.endNode)}}class $a{constructor(a,b,d){this.value=void 0,this.__pendingValue=void 0;if(d.length!==2||d[0]!==""||d[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=a,this.name=b,this.strings=d}setValue(a){this.__pendingValue=a}commit(){for(;V(this.__pendingValue);){const b=this.__pendingValue;this.__pendingValue=v,b(this)}if(this.__pendingValue===v)return;const a=!!this.__pendingValue;this.value!==a&&(a?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=a),this.__pendingValue=v}}class bb extends ua{constructor(a,b,d){super(a,b,d);this.single=d.length===2&&d[0]===""&&d[1]===""}_createPart(){return new rb(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class rb extends eb{}let fb=!1;(()=>{try{const a={get capture(){return fb=!0,!1}};window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch(a){}})();class ab{constructor(a,b,d){this.value=void 0,this.__pendingValue=void 0,this.element=a,this.eventName=b,this.eventContext=d,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(a){this.__pendingValue=a}commit(){for(;V(this.__pendingValue);){const f=this.__pendingValue;this.__pendingValue=v,f(this)}if(this.__pendingValue===v)return;const a=this.__pendingValue,b=this.value,d=a==null||b!=null&&(a.capture!==b.capture||a.once!==b.once||a.passive!==b.passive),e=a!=null&&(b==null||d);d&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),e&&(this.__options=sb(a),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=a,this.__pendingValue=v}handleEvent(a){typeof this.value==="function"?this.value.call(this.eventContext||this.element,a):this.value.handleEvent(a)}}const sb=a=>a&&(fb?{capture:a.capture,passive:a.passive,once:a.once}:a.capture);class pb{handleAttributeExpressions(a,b,d,e){const f=b[0];if(f==="."){const h=new bb(a,b.slice(1),d);return h.parts}if(f==="@")return[new ab(a,b.slice(1),e.eventContext)];if(f==="?")return[new $a(a,b.slice(1),d)];const j=new ua(a,b,d);return j.parts}handleTextExpression(a){return new aa(a)}}const cb=new pb();function gb(a){let b=jb.get(a.type);b===void 0&&(b={stringsArray:new WeakMap(),keyString:new Map()},jb.set(a.type,b));let d=b.stringsArray.get(a.strings);if(d!==void 0)return d;const e=a.strings.join(E);return d=b.keyString.get(e),d===void 0&&(d=new ib(a,a.getTemplateElement()),b.keyString.set(e,d)),b.stringsArray.set(a.strings,d),d}const jb=new Map();const hb=new WeakMap(),P=(a,b,d)=>{let e=hb.get(b);e===void 0&&(ka(b,b.firstChild),hb.set(b,e=new aa(Object.assign({templateFactory:gb},d))),e.appendInto(b)),e.setValue(a),e.commit()};typeof window!=="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const i=(a,...b)=>new la(a,b,"html",cb);let t=a=>document.getElementById(a),o=a=>parseInt(a.closest("section").id),T=a=>parseInt(a.closest(".field").id),Z=()=>Math.round(new Date().getTime()*Math.random()),_=a=>a.replace(/\W+|[-_]/g,"-");function*B(a,b){for(let d of a)yield{section:d,parent:b},d.children&&(yield*B(d.children,d))}function D(a){let b;for(let{section:d,parent:e}of B(c.now.children))if(d.id==a){b=d;break}return b}function ja(a){let b=a.closest("section"),d=b.getAttribute("data-section-depth");return parseInt(d)}function ga(a,b,d){let e=a[b]||[],f=e[d];e.splice(d,1),e.splice(d-1,0,f),s(),n(),c.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveUp`)?.focus()}function fa(a,b,d){let e=a[b]||[],f=e[d];e.splice(d,1),e.splice(d+1,0,f),s(),n(),c.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveDown`)?.focus()}function R(){c.now.selected.fieldType=c.now.fieldTypes?.[0]||{},c.now.selected.globalType=c.now.globalTypes?.[0]||{};for(let{section:a,parent:b}of B(c.now.children)){if(!a.fields.length)continue;a.fields.map(d=>{d.type=c.now.fieldTypes.find(e=>e.id==d.type?.id)||c.now.fieldTypes?.[0]})}}class J{constructor(a=0){this.id=Z(),this.depth=a,this.text="",this.html="",this.children=[],this.fields=[]}}class Ca{constructor(){this.id=Z(),this.value="",this.type=0}}class Q{constructor(a){this.id=Z(),this.name=a,this.css=""}}class nb{constructor(a){this.id=Z(),this.name=a}}class ba extends nb{constructor(a){super(a);this.type="field type",this.css=""}}const r=["Chapter","Section","Block"],L={h1:"Lvl 1 Heading",h2:"Lvl 2 Heading",h3:"Lvl 3 Heading",h4:"Lvl 4 Heading",h5:"Lvl 5 Heading",h6:"Lvl 6 Heading",hr:"Horizontal Rules",p:"Paragraph",blockquote:"Block Quote",ul:"Unordered List",ol:"Ordered List",li:"List Item",a:"Link",strong:"Bolded Text",em:"Italic Text",code:"Code",img:"Image"},u={previewPane:t("preview"),toolbar:t("toolbar"),contentEditorPane:t("content_editor"),styleEditorPane:t("style_editor"),modal:t("modal"),customStyles:t("custom_styles"),walkThroughDialogue:t("walkthrough_dialogue"),mobileNav:t("mobile_nav")},ca={throttle:60,mobileBreakpoint:960,saveInterval:2000};let Da;try{Da=JSON.parse(localStorage.getItem("State"))}catch(a){console.log("No previous data found.")}const c=Da||{now:{children:[],fieldTypes:[],globalTypes:r.map(a=>new Q(a)).concat(Object.values(L).map(a=>new Q(a))),selected:{fieldType:{},globalType:{}},editing:{}},nowIndex:0,settings:{darkMode:!1,advancedUI:!1,messagesShown:!1},walkthroughIndex:0,history:[],hasChanged:!1,isNewUser:!0,isMobile:innerWidth<=ca.mobileBreakpoint,lastSaved:new Date(),forExport:""};const Ta=a=>{let b=o(a.target),d=ja(a.target),e;for(let{section:f,parent:j}of B(c.now.children,c.now))if(f.id==b){let h=new J(d);j.children.push(h),e=h.id;break}c.hasChanged=!0,s(),c.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Ua=a=>{let b=o(a.target),d=ja(a.target),e;for(let{section:f,parent:j}of B(c.now.children,c.now))if(f.id==b){let h=new J(d+1);f.children.unshift(h),e=h.id;break}c.hasChanged=!0,s(),c.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Va=a=>{let b=o(a.target);for(let{section:d,parent:e}of B(c.now.children,c.now)){if(d.id!=b)continue;e.children=e.children.filter(f=>f!=d)}c.hasChanged=!0,n(),s()};const Wa=a=>{let b=o(a.target),d=D(b);d.text=a.target.value,c.hasChanged=!0,n()};const S={addSiblingSection:Ta,addChildSection:Ua,removeSection:Va,updateSection:Wa};const Ka=a=>{let b=o(a.target),d=D(b),e=new Ca();e.type=c.now.fieldTypes[0],d.fields.push(e),c.hasChanged=!0,s(),c.isMobile||document.querySelector(`[id="${e.id}"] input`)?.focus()};const La=a=>{let b=o(a.target),d=D(b),e=T(a.target);d.fields=d.fields.filter(f=>f.id!=e),c.hasChanged=!0,s(),n()};const Ma=a=>{let b=o(a.target),d=D(b),e=T(a.target),f=d.fields.find(j=>j.id==e);f.value=a.target.value,c.hasChanged=!0,n()};const Na=a=>{let b=a.target.value,d=T(a.target),e=o(a.target),f=D(e),j=f.fields.find(h=>h.id==d);j.type=c.now.fieldTypes.find(h=>h.id==b),c.hasChanged=!0,n()};const M={addField:Ka,removeField:La,updateFieldValue:Ma,updateFieldType:Na};const Xa=a=>{let b=a.target.textContent||"";a.target.id.includes("global")&&(c.now.selected.globalType.css=b,c.hasChanged=!0),a.target.id.includes("field")&&(c.now.selected.fieldType.css=b,c.hasChanged=!0),ta()};const U=a=>{let b=a.target||a,d=(e,f)=>`<span class="token ${f}">${e}</span>`;b.innerHTML=b.innerText.replace(/\n/g,"").replace(/;/g,d(";","newline")).replace(/[,:](?!\s)/g,e=>e+" ")};const Ya=a=>{let b=a.target.value,d=t("field_type_styles"),e=c.now.fieldTypes.find(f=>f.id==b);if(e)e.css||(e.css=""),c.now.selected.fieldType=e;else{let f={id:b,css:""};c.now.fieldTypes.push(f),c.now.selected.fieldType=f}d.innerHTML=c.now.selected.fieldType.css,U(d),c.hasChanged=!0,n()};const Za=a=>{let b=t("global_type_styles"),d=a.target.value,e=c.now.globalTypes.find(f=>f.name==d);if(e)e.css||(e.css=""),c.now.selected.globalType=e;else{let f={id:d,css:""};c.now.globalTypes.push(f),c.now.selected.globalType=f}b.innerHTML=c.now.selected.globalType.css,U(b),c.hasChanged=!0,n()};const z={updateStyles:Xa,updateCurrentFieldType:Ya,updateCurrentGlobalType:Za,formatCSS:U};const Ga=a=>{a=="field type"&&(c.now.fieldTypes=c.now.fieldTypes.filter(b=>b.id!=c.now.selected.fieldType.id),c.now.selected.fieldType=c.now.fieldTypes?.[0]||{}),c.now.editing={},c.hasChanged=!0,q(),A(null)};const Ha=a=>{c.now.editing[a.target.name]=a.target.value,c.hasChanged=!0,q()};const Ja=()=>{c.now.selected.fieldType=c.now.fieldTypes[c.now.fieldTypes.length-1];if(c.now.fieldTypes.length==1)for(let{section:a,parent:b}of B(c.now.children))a.fields.map(d=>d.type=c.now.fieldTypes[0])};const Ia=a=>{c.now.editing.name=c.now.editing.name.trim();if(!c.now.editing.name.length){A(null);return}a=="field type"&&(c.now.fieldTypes.push(new ba(c.now.editing.name)),Ja(),u.styleEditorPane.querySelector("code")?.focus()),c.now.editing={},c.hasChanged=!0,q(),A(null)};const $={removeType:Ga,updateType:Ha,saveNewType:Ia};const Oa=a=>{let b=c.settings.darkMode;document.documentElement.classList.toggle("dark_mode",!b),c.settings.darkMode=!b,c.hasChanged=!0,K()};const Pa=a=>{let b=c.settings.advancedUI;document.documentElement.classList.toggle("advanced",!b),c.settings.advancedUI=!b,c.hasChanged=!0,K()};const Qa=a=>window.print();const Ra=a=>{let b=a.target.files[0],d=new FileReader();d.onerror=function(){console.error(this.error)},d.onload=function(){let e=JSON.parse(this.result);Object.keys(c).map(f=>c[f]=e[f]),R(),q()},document.body.classList.add("importing"),d.readAsText(b)};const Sa=a=>{c.now.children=[new J()],c.now.fieldTypes=[],c.now.globalTypes=r.map(b=>new Q(b)).concat(Object.values(L).map(b=>new Q(b))),c.now.editing={},c.now.selected={fieldType:{},globalType:{}},q(),c.hasChanged=!0};const N={toggleDarkMode:Oa,toggleAdvancedUI:Pa,printDocument:Qa,importData:Ra,clearData:Sa};const ha=({global:a=!1,field:b={}}={})=>{if(!c.now.fieldTypes?.length)return;let d=a?c.now.selected.fieldType?.id:b?.type?.id;return i`
    <select name=type @input=${a?z.updateCurrentFieldType:M.updateFieldType}>

        ${c.now.fieldTypes.map(e=>i`
            <option value=${e.id} ?selected=${e.id==d}>
                ${e.name}
            </option>
        `)}

    </select>`};const Ea=(a,b,d)=>i`
<div 
class=field 
id=${a.id}>

    <input 
    placeholder="Field value..."
    type=text 
    .value=${a.value} 
    @input=${M.updateFieldValue} />

    ${ha({field:a})}

    <button 
    @click=${M.removeField} 
    class=remove>
        Remove
    </button>

    <button
    data-icon
    @click=${fa.bind(void 0,b,"fields",d)}
    ?disabled=${d>=b.fields.length-1}
    class="move moveDown">
    </button>

    <button
    data-icon
    @click=${ga.bind(void 0,b,"fields",d)}
    ?disabled=${!d} 
    class="move moveUp">
    </button>

</div>`;function da(a,b,d){let e=c.now.children.length,f=a.depth,j=f==r.length-1;return i`
    <section 
    id=${a.id} 
    data-section-depth=${a.depth}>

        <div class=fields>
            ${a.fields.map((h,m)=>Ea(h,a,m))}
        </div>

        <textarea 
        id="${a.id}-text"
        placeholder=${"Write something for this "+r[f].toLowerCase()+"..."} 
        @input=${S.updateSection} 
        .value=${a.text}>
        </textarea>

        <div class=actions>

            <button 
            data-icon=add_another
            title=${"Add "+r[f]}
            @click=${S.addSiblingSection}>
            </button>

            ${j?"":i`
            <button 
            data-icon=add_sub
            title=${"Add "+r[f+1]}
            @click=${S.addChildSection}>
            </button>`}

            <button 
            class=add
            data-icon
            title="Add Field"
            @click=${M.addField}>
            </button>

            ${e>1||f?i`
            <button 
            class=remove
            @click=${S.removeSection}>
            Remove
            </button>`:""}

            ${b.children.length>1?i`

            <button 
            class="move moveDown" 
            data-icon
            title="Move Down"
            ?disabled=${d>=b.children.length-1} 
            @click=${fa.bind(this,b,"children",d)}>
            </button>

            <button 
            class="move moveUp"
            data-icon
            title="Move Up"
            ?disabled=${!d} 
            @click=${ga.bind(this,b,"children",d)}>
            </button>
            
            `:""}

        </div>

        ${a.children.length?a.children.map((h,m)=>da(h,a,m)):""}

    </section>`}const ia=a=>{let b={"!":"33","#":"35","&":"38;","(":"40",")":"41","*":"42","+":"43","-":"45",".":"46","<":"60;",">":"62;","[":"91","\\":"92","]":"93",_:"95","`":"96","{":"123","}":"125","~":"126"},d=/(^|\s)(> )+(.|\n)+?(?=$|\n(?!>))/g,e="[0-9]+\\. ",f="[-+*] ",j=g=>"&#"+(b[g]||g),h=g=>g.replace(/[&<>]/g,j),m=g=>g.trim().slice(1,-1),p=(g,l)=>`<${g}>${l}</${g}>`,Aa=g=>{let l=new RegExp(`[^|\\n]${e}`).test(g),y=new RegExp(`(^|\\n)${l?e:f}`),Y=g.split(y).filter(Ba=>Ba.trim().length);return p(l?"ol":"ul",Y.map(Ba=>p("li",Ba)).join(""))},k=g=>{g=g.trim();let l=g.indexOf(" ");return p(`h${l}`,g.slice(l).replace(/#+$/,"").trim())},w=g=>{let l=g.trim().split(/\n/);return p(`h${l[1].indexOf("-")>-1?2:1}`,l[0])},X=g=>{let l=g.slice(1,-1).split("]("),y=l[1].split(/ ["`']/)[1];return`<a href="${l[1]}" ${y?`title="${y}"`:""}>${l[0]}</a>`},G=g=>{let l=g.split(/["`']/),y=l[0].trim().replace(/^<|>$/g,""),Y=l[1];return` <a href="${y}" ${Y?`title="${Y}"`:""}>${y}</a>`},x=g=>{let l=g.slice(2,-1).split("]("),y=l[1].split(/ ["`']/)[1];return`<img src="${l[1]}" ${y?`title="${y}"`:""} alt="${l[0]}">`},O=g=>{let[l,...y]=g.trim().split(/\n+/),Y=h(y.slice(0,-1).join("\r")).trim();return p("pre",`<code class="language-${l.slice(3)}">${Y}</code>`)},H=g=>(g=p("blockquote",g.replace(/^ *?> /gm,"")),g.replace(d,H)),I=g=>` <a href="${g}">${g.trim()}</a>`,C=g=>p("p",g.trim()),ub=g=>p("strong",g.slice(2,-2)),vb=g=>p("em",m(g)),wb=g=>p("del",m(g)),xb=g=>p("code",h(m(g)));return a.replace(/\r+/g,`
`).replace(/\\[-*_\\`#~+.!(){}[\]]/g,g=>j(g.slice(1))).replace(/(^|\n).+?\n[-=]+(?=$|\n)/g,w).replace(/(^|\n)#+? (.|\n)+?(?=$|\n)/g,k).replace(/(^|\n)([-*_] ?){3,}(?=$|\n)/g,"<hr>").replace(/(^|\n)([0-9]+\.|[-+*]) (.|\n)+?(?=$|[\s\n]{3,})/g,Aa).replace(d,H).replace(/(^|\n)```(.|\n)+?```(?=$|\n)/g,O).replace(/  (\n|$)/g,"<br>").replace(/!\[.+?\]\(.+?\)/g,x).replace(/\[.+?\]\(.+?\)/g,X).replace(/<(https?:\/\/|www).+?>( (".+?")|('.+?'))?(?=$|\n| )/g,G).replace(/(^|\n| )(https?:\/\/|www)(.+?)+?(?=$|\n| )/g,I).replace(/\s[*_](?=\s)/g,g=>g.slice(0,1)+j(g.slice(1))).replace(/[*_]{2}.+?[*_]{2}/gm,ub).replace(/[*_].+?[*_]/gm,vb).replace(/~.+?~/gm,wb).replace(/`.+?`/gm,xb).replace(/(^|\n\n+)(?!<[huol]).+?(?=$|\n\n+)/gi,C)};const Fa=a=>{let b=c.now.fieldTypes.find(e=>e.id==a?.type?.id),d=document.createElement("div");return d.innerHTML=ia(a.value),/<p>/.test(d.innerHTML)&&(d.innerHTML=d.firstElementChild.innerHTML),i`
    <div class=${_(b?.name||"")}>
        ${d}
    </div>`};function ea(a){let b=document.createElement("div");return b.classList.add("content"),b.innerHTML=ia(a.text),i`
    <section class=${r[a.depth]}>
    
        ${a.fields.map(d=>Fa(d))}
    
        ${a.text.length?b:""}
    
        ${a.children.map(d=>ea(d))}
    
    </section>`}const pa=()=>i`

<div class="heading">
    Style Editor
    <span tabindex="0" data-tooltip="This pane is for editing your document's styles. Apply valid CSS rules to any custom field type or global element."></span>
</div>

<section id=manageFieldTypes>

    <div class=actions>

        <label>Field Styles</label>

        ${ha({global:!0})}

        ${c.now.fieldTypes?.length?i`
        <button 
        data-icon
        title="Edit Field Type"
        @click=${A.bind(void 0,"field type",!0)}>
        </button>`:""}

        <button 
        class=add 
        data-icon
        title="New Field Type"
        @click=${A.bind(void 0,"field type",!1)}>
        </button>
        
    </div>

    <code 
    spellcheck=false
    id=field_type_styles
    class=language-css 
    contenteditable=true 
    @focusout=${z.formatCSS}
    @keyup=${z.updateStyles}></code>
    
</section>


<section id=manageGlobalTypes>

    <div class=actions>

        <label>Global Styles</label>

        <select id=global-style-select @input=${z.updateCurrentGlobalType}>

            <optgroup label=Layout>
            ${r.map(a=>i`
                <option
                value=${a}
                ?selected=${a==c.now.selected.globalType?.name}>
                    ${a}s
                </option>
            `)}
            </optgroup>

            <optgroup label=Elements>
                ${Object.values(L).map(a=>i`
                    <option 
                    label=${a}
                    value=${a}
                    ?selected=${a==c.now.selected.globalType?.name}>
                        ${a}s
                    </option>
                `)}
            </optgroup>
        </select>

    </div>

    <code
    spellcheck=false
    id=global_type_styles
    class=language-css
    contenteditable=true
    @focusout=${z.formatCSS}
    @keyup=${z.updateStyles}></code>

</section>
`;const qa=()=>i`

${c.now.fieldTypes.map(a=>`#preview .${_(a.name).trim()}{${a.css}}`)}

${r.map(a=>{let b=c.now.globalTypes.find(d=>d.name==a);return`#preview .${_(a).trim()}{${b?.css}}`})}

${Object.keys(L).map(a=>{let b=L[a],d=c.now.globalTypes.find(e=>e.name==b);return`#preview ${a} {${d?.css}}`})}
`;const na=(a=0)=>{let b=c.nowIndex+a;c.now=JSON.parse(c.history[b]),c.nowIndex=b,R(),q()};const ra=()=>{let a=c.settings;return i`
    <!-- Undo/Redo -->
    <div class=configuration id=undo_redo>
        <button data-icon title=Undo ?disabled=${c.nowIndex==0} @click=${na.bind(void 0,-1)}>
        </button>
        <button data-icon title=Redo ?disabled=${c.nowIndex>=c.history.length-1}
            @click=${na.bind(void 0,1)}>
        </button>
    </div>
    
    <!-- Toggle Dark Mode -->
    <div class=configuration>
        <button data-icon title=${"You're in "+(a.darkMode?"Dark":"Light")+" Mode"}
            ?aria-pressed=${a.darkMode} @click=${N.toggleDarkMode} id=dark_mode_toggle>
        </button>
    </div>
    
    <!-- Toggle Advanced UI -->
    <div class=configuration id=advancedUI_toggle>
        <button data-icon id="advanced_toggle" ?aria-pressed=${a.advancedUI} title=${(a.advancedUI?"Disable":"Enable")+" Advanced UI"} @click=${N.toggleAdvancedUI}>
        </button>
    </div>
    
    <!-- Print Document -->
    <div class=configuration id=printDocument>
        <button data-icon title=Print @click=${N.printDocument}>
        </button>
    </div>
    
    <!-- Import and Export Data -->
    <div class=configuration id=import_export>
        <input aria-hidden="true" id=importData type=file accept=.json @input=${N.importData}>
        <label data-icon title="Import Data" class="fileInput secondary" for=importData>
        </label>
        <a class="button primary" data-icon title="Export Data" id=exportData .href=${c?.forExport} download=${`My WRDS Backup (${new Date(c.lastSaved).toLocaleDateString()}).json`}>
        </a>
        <!-- Clear Data -->
        <button data-icon title="Clear Data" class=destructive @click=${N.clearData}>
        </button>
    </div>
    
    <!-- Last Saved -->
    <div class=configuration id=savedIndicator>
        Saved: ${new Date(c?.lastSaved||"").toLocaleTimeString("en-us",{timeStyle:"short"})}
    </div>`};const sa=(a,b)=>a?(a=="field type"&&(c.now.editing=b?c.now.selected.fieldType:new ba()),i`
    <div class=content>
    
        <div class=heading>
            ${c.now.editing.type} Editor
            <span tabindex=0 data-tooltip=${"This pane is for renaming or editing your "+c.now.editing.type+" ."}>
            </span>
        </div>
    
        <input name=name @input=${$.updateType} type=text placeholder=${"Name your "+c.now.editing.type+"..."} value=${b?c.now.editing.name:""} />
        
            <div class=actions>
        
                <button @click=${b?A.bind(void 0,null):$.saveNewType.bind(void 0,c.now.editing.type)}>
                    Done
                </button>
        
                ${b?i`
                <button class=remove @click=${$.removeType.bind(void 0,c.now.editing.type)}>
                    Delete ${c.now.editing.type}
                </button>`:""}
        
                <button class=cancel @click=${A.bind(void 0,null)}>
                    Cancel
                </button>
        
            </div>
        
        </div>`):"";async function q(){s(),K(),n(),_a(),ta()}async function n(){P(i`
        <div class=content>
            ${c.now.children.map(a=>ea(a))}
        </div>`,u.previewPane)}async function K(){let a=document.documentElement;a.classList.toggle("dark_mode",c.settings.darkMode),a.classList.toggle("advanced",c.settings.advancedUI),P(ra(),u.toolbar)}function ta(){P(qa(),u.customStyles)}function A(a,b=!1){u.modal.classList.toggle("open",a),P(sa(a,b),u.modal);if(a)try{u.modal.querySelector("input").focus()}catch(d){}a||(c.now.editing={},K(),_a(),n())}function _a(){P(pa(),u.styleEditorPane);for(let a of u.styleEditorPane.querySelectorAll("code"))a.innerHTML="",a.id.includes("field")&&(a.innerText=c.now.selected.fieldType?.css||""),a.id.includes("global")&&(a.innerText=c.now.selected.globalType?.css||""),z?.formatCSS({target:a})}function s(){P(i`
        <div class=heading>
            Content Editor
            <span tabindex=0
                data-tooltip="This pane is for editing the content of your document. Try nesting content blocks or adding custom fields to a section."></span>
        </div>
        
        ${c.now.children.map((a,b)=>da(a,c.now,b))}
        `,u.contentEditorPane)}async function oa(a=!1){if(!c.hasChanged&&!a)return;localStorage.setItem("State",JSON.stringify(c));let b=JSON.stringify(c,(d,e)=>d=="history"?[]:d=="settings"?{}:e);c.history.push(JSON.stringify(c.now)),c.nowIndex=c.history.length-1,c.history.length>250&&c.history.splice(0,1),c.hasChanged=!1,c.lastSaved=new Date().getTime(),c.forExport=URL.createObjectURL(new Blob([b],{type:"application/json"})),K()}c.isNewUser&&!c.now.children.length&&(c.now.children.push(new J()),oa(!0));R();q();setInterval(oa,ca.saveInterval);document.body.classList.remove("loading");c.isMobile=innerWidth<ca.mobileBreakpoint;for(let a of document.querySelectorAll("[data-icon]"))a.setAttribute("aria-hidden",!0);})();
