(()=>{const rb=new WeakMap(),X=a=>typeof a==="function"&&rb.has(a);const wa=typeof window!=="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,la=(a,c,d=null)=>{for(;c!==d;){const e=c.nextSibling;a.removeChild(c),c=e}};const x={},U={};const E=`{{lit-${String(Math.random()).slice(2)}}}`,za=`<!--${E}-->`,mb=new RegExp(`${E}|${za}`),Y="$lit$";class jb{constructor(a,c){this.parts=[],this.element=c;const d=[],e=[],f=document.createTreeWalker(c.content,133,null,!1);let h=0,g=-1,l=0;const{strings:J,values:{length:j}}=a;for(;l<j;){const k=f.nextNode();if(k===null){f.currentNode=e.pop();continue}g++;if(k.nodeType===1){if(k.hasAttributes()){const m=k.attributes,{length:Q}=m;let F=0;for(let o=0;o<Q;o++)nb(m[o].name,Y)&&F++;for(;F-- >0;){const o=J[l],v=na.exec(o)[2],A=v.toLowerCase()+Y,R=k.getAttribute(A);k.removeAttribute(A);const K=R.split(mb);this.parts.push({type:"attribute",index:g,name:v,strings:K}),l+=K.length-1}}k.tagName==="TEMPLATE"&&(e.push(k),f.currentNode=k.content)}else if(k.nodeType===3){const m=k.data;if(m.indexOf(E)>=0){const Q=k.parentNode,F=m.split(mb),o=F.length-1;for(let v=0;v<o;v++){let A,R=F[v];if(R==="")A=I();else{const K=na.exec(R);K!==null&&nb(K[2],Y)&&(R=R.slice(0,K.index)+K[1]+K[2].slice(0,-Y.length)+K[3]),A=document.createTextNode(R)}Q.insertBefore(A,k),this.parts.push({type:"node",index:++g})}F[o]===""?(Q.insertBefore(I(),k),d.push(k)):k.data=F[o],l+=o}}else if(k.nodeType===8)if(k.data===E){const m=k.parentNode;(k.previousSibling===null||g===h)&&(g++,m.insertBefore(I(),k)),h=g,this.parts.push({type:"node",index:g}),k.nextSibling===null?k.data="":(d.push(k),g--),l++}else{let m=-1;for(;(m=k.data.indexOf(E,m+1))!==-1;)this.parts.push({type:"node",index:-1}),l++}}for(const k of d)k.parentNode.removeChild(k)}}const nb=(a,c)=>{const d=a.length-c.length;return d>=0&&a.slice(d)===c},lb=a=>a.index!==-1,I=()=>document.createComment(""),na=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class xa{constructor(a,c,d){this.__parts=[],this.template=a,this.processor=c,this.options=d}update(a){let c=0;for(const d of this.__parts)d!==void 0&&d.setValue(a[c]),c++;for(const d of this.__parts)d!==void 0&&d.commit()}_clone(){const a=wa?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),c=[],d=this.template.parts,e=document.createTreeWalker(a,133,null,!1);let f=0,h=0,g,l=e.nextNode();for(;f<d.length;){g=d[f];if(!lb(g)){this.__parts.push(void 0),f++;continue}for(;h<g.index;)h++,l.nodeName==="TEMPLATE"&&(c.push(l),e.currentNode=l.content),(l=e.nextNode())===null&&(e.currentNode=c.pop(),l=e.nextNode());if(g.type==="node"){const J=this.processor.handleTextExpression(this.options);J.insertAfterNode(l.previousSibling),this.__parts.push(J)}else this.__parts.push(...this.processor.handleAttributeExpressions(l,g.name,g.strings,this.options));f++}return wa&&(document.adoptNode(a),customElements.upgrade(a)),a}}const ub=` ${E} `;class ma{constructor(a,c,d,e){this.strings=a,this.values=c,this.type=d,this.processor=e}getHTML(){const a=this.strings.length-1;let c="",d=!1;for(let e=0;e<a;e++){const f=this.strings[e],h=f.lastIndexOf("<!--");d=(h>-1||d)&&f.indexOf("-->",h+1)===-1;const g=na.exec(f);g===null?c+=f+(d?ub:za):c+=f.substr(0,g.index)+g[1]+g[2]+Y+g[3]+E}return c+=this.strings[a],c}getTemplateElement(){const a=document.createElement("template");return a.innerHTML=this.getHTML(),a}}const ya=a=>a===null||!(typeof a==="object"||typeof a==="function"),eb=a=>Array.isArray(a)||!!(a&&a[Symbol.iterator]);class va{constructor(a,c,d){this.dirty=!0,this.element=a,this.name=c,this.strings=d,this.parts=[];for(let e=0;e<d.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new fb(this)}_getValue(){const a=this.strings,c=a.length-1;let d="";for(let e=0;e<c;e++){d+=a[e];const f=this.parts[e];if(f!==void 0){const h=f.value;if(ya(h)||!eb(h))d+=typeof h==="string"?h:String(h);else for(const g of h)d+=typeof g==="string"?g:String(g)}}return d+=a[c],d}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class fb{constructor(a){this.value=void 0,this.committer=a}setValue(a){a!==x&&(!ya(a)||a!==this.value)&&(this.value=a,X(a)||(this.committer.dirty=!0))}commit(){for(;X(this.value);){const a=this.value;this.value=x,a(this)}if(this.value===x)return;this.committer.commit()}}class aa{constructor(a){this.value=void 0,this.__pendingValue=void 0,this.options=a}appendInto(a){this.startNode=a.appendChild(I()),this.endNode=a.appendChild(I())}insertAfterNode(a){this.startNode=a,this.endNode=a.nextSibling}appendIntoPart(a){a.__insert(this.startNode=I()),a.__insert(this.endNode=I())}insertAfterPart(a){a.__insert(this.startNode=I()),this.endNode=a.endNode,a.endNode=this.startNode}setValue(a){this.__pendingValue=a}commit(){if(this.startNode.parentNode===null)return;for(;X(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=x,c(this)}const a=this.__pendingValue;if(a===x)return;ya(a)?a!==this.value&&this.__commitText(a):a instanceof ma?this.__commitTemplateResult(a):a instanceof Node?this.__commitNode(a):eb(a)?this.__commitIterable(a):a===U?(this.value=U,this.clear()):this.__commitText(a)}__insert(a){this.endNode.parentNode.insertBefore(a,this.endNode)}__commitNode(a){if(this.value===a)return;this.clear(),this.__insert(a),this.value=a}__commitText(a){const c=this.startNode.nextSibling;a=a==null?"":a;const d=typeof a==="string"?a:String(a);c===this.endNode.previousSibling&&c.nodeType===3?c.data=d:this.__commitNode(document.createTextNode(d)),this.value=a}__commitTemplateResult(a){const c=this.options.templateFactory(a);if(this.value instanceof xa&&this.value.template===c)this.value.update(a.values);else{const d=new xa(c,a.processor,this.options),e=d._clone();d.update(a.values),this.__commitNode(e),this.value=d}}__commitIterable(a){Array.isArray(this.value)||(this.value=[],this.clear());const c=this.value;let d=0,e;for(const f of a)e=c[d],e===void 0&&(e=new aa(this.options),c.push(e),d===0?e.appendIntoPart(this):e.insertAfterPart(c[d-1])),e.setValue(f),e.commit(),d++;d<c.length&&(c.length=d,this.clear(e&&e.endNode))}clear(a=this.startNode){la(this.startNode.parentNode,a.nextSibling,this.endNode)}}class ab{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0;if(d.length!==2||d[0]!==""||d[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=a,this.name=c,this.strings=d}setValue(a){this.__pendingValue=a}commit(){for(;X(this.__pendingValue);){const c=this.__pendingValue;this.__pendingValue=x,c(this)}if(this.__pendingValue===x)return;const a=!!this.__pendingValue;this.value!==a&&(a?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=a),this.__pendingValue=x}}class cb extends va{constructor(a,c,d){super(a,c,d);this.single=d.length===2&&d[0]===""&&d[1]===""}_createPart(){return new sb(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class sb extends fb{}let gb=!1;(()=>{try{const a={get capture(){return gb=!0,!1}};window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch(a){}})();class bb{constructor(a,c,d){this.value=void 0,this.__pendingValue=void 0,this.element=a,this.eventName=c,this.eventContext=d,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(a){this.__pendingValue=a}commit(){for(;X(this.__pendingValue);){const f=this.__pendingValue;this.__pendingValue=x,f(this)}if(this.__pendingValue===x)return;const a=this.__pendingValue,c=this.value,d=a==null||c!=null&&(a.capture!==c.capture||a.once!==c.once||a.passive!==c.passive),e=a!=null&&(c==null||d);d&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),e&&(this.__options=tb(a),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=a,this.__pendingValue=x}handleEvent(a){typeof this.value==="function"?this.value.call(this.eventContext||this.element,a):this.value.handleEvent(a)}}const tb=a=>a&&(gb?{capture:a.capture,passive:a.passive,once:a.once}:a.capture);class qb{handleAttributeExpressions(a,c,d,e){const f=c[0];if(f==="."){const g=new cb(a,c.slice(1),d);return g.parts}if(f==="@")return[new bb(a,c.slice(1),e.eventContext)];if(f==="?")return[new ab(a,c.slice(1),d)];const h=new va(a,c,d);return h.parts}handleTextExpression(a){return new aa(a)}}const db=new qb();function hb(a){let c=kb.get(a.type);c===void 0&&(c={stringsArray:new WeakMap(),keyString:new Map()},kb.set(a.type,c));let d=c.stringsArray.get(a.strings);if(d!==void 0)return d;const e=a.strings.join(E);return d=c.keyString.get(e),d===void 0&&(d=new jb(a,a.getTemplateElement()),c.keyString.set(e,d)),c.stringsArray.set(a.strings,d),d}const kb=new Map();const ib=new WeakMap(),P=(a,c,d)=>{let e=ib.get(c);e===void 0&&(la(c,c.firstChild),ib.set(c,e=new aa(Object.assign({templateFactory:hb},d))),e.appendInto(c)),e.setValue(a),e.commit()};typeof window!=="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");const i=(a,...c)=>new ma(a,c,"html",db);let u=a=>document.getElementById(a),q=a=>parseInt(a.closest("section").id),V=a=>parseInt(a.closest(".field").id),Z=()=>Math.round(new Date().getTime()*Math.random()),_=a=>a.replace(/\W+|[-_]/g,"-");function*z(a,c){for(let d of a)yield{section:d,parent:c},d.children&&(yield*z(d.children,d))}function D(a){let c;for(let{section:d,parent:e}of z(b.now.children))if(d.id==a){c=d;break}return c}function ka(a){let c=a.closest("section"),d=c.getAttribute("data-section-depth");return parseInt(d)}function ha(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d-1,0,f),t(),n(),b.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveUp`)?.focus()}function ga(a,c,d){let e=a[c]||[],f=e[d];e.splice(d,1),e.splice(d+1,0,f),t(),n(),b.hasChanged=!0,document.activeElement.blur(),document.querySelector(`[id="${f.id}"] .moveDown`)?.focus()}function L(){b.now.fieldTypes=b.now.selected.template.fieldTypes||[],b.now.globalTypes=b.now.selected.template.globalTypes||b.now.globalTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{},b.now.selected.globalType=b.now.globalTypes?.[0]||{};for(let{section:a,parent:c}of z(b.now.children)){if(!a.fields.length)continue;a.fields.map(d=>{d.type=b.now.fieldTypes.find(e=>e.id==d.type?.id)||b.now.fieldTypes?.[0]})}}class G{constructor(a=0){this.id=Z(),this.depth=a,this.text="",this.html="",this.children=[],this.fields=[]}}class Aa{constructor(){this.id=Z(),this.value="",this.type=0}}class O{constructor(a){this.id=Z(),this.name=a,this.css=""}}class Ba{constructor(a){this.id=Z(),this.name=a}}class ca extends Ba{constructor(a){super(a);this.type="field type",this.css=""}}class da extends Ba{constructor(a){super(a);this.type="template",this.fieldTypes=[],this.globalTypes=[]}}const r=["Chapter","Section","Block"],M={h1:"Lvl 1 Heading",h2:"Lvl 2 Heading",h3:"Lvl 3 Heading",h4:"Lvl 4 Heading",h5:"Lvl 5 Heading",h6:"Lvl 6 Heading",hr:"Horizontal Rules",p:"Paragraph",blockquote:"Block Quote",ul:"Unordered List",ol:"Ordered List",li:"List Item",a:"Link",strong:"Bolded Text",em:"Italic Text",code:"Code",img:"Image"},w={previewPane:u("preview"),toolbar:u("toolbar"),contentEditorPane:u("content_editor"),styleEditorPane:u("style_editor"),modal:u("modal"),customStyles:u("custom_styles"),walkThroughDialogue:u("walkthrough_dialogue"),mobileNav:u("mobile_nav")},H={throttle:60,mobileBreakpoint:960,saveInterval:2000,zoom:{min:.5,max:2,interval:.1}};let Ca;try{Ca=JSON.parse(localStorage.getItem("State"))}catch(a){console.log("No previous data found.")}const b=Ca||{now:{children:[],fieldTypes:[],globalTypes:r.map(a=>new O(a)).concat(Object.values(M).map(a=>new O(a))),selected:{fieldType:{},globalType:{},template:{}},editing:{}},nowIndex:0,settings:{zoom:1,darkMode:!1,advancedUI:!1,messagesShown:!1},walkthroughIndex:0,history:[],templates:[],hasChanged:!1,isNewUser:!0,isMobile:innerWidth<=H.mobileBreakpoint,lastSaved:new Date(),forExport:""};const Ua=a=>{let c=q(a.target),d=ka(a.target),e;for(let{section:f,parent:h}of z(b.now.children,b.now))if(f.id==c){let g=new G(d);h.children.push(g),e=g.id;break}b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Va=a=>{let c=q(a.target),d=ka(a.target),e;for(let{section:f,parent:h}of z(b.now.children,b.now))if(f.id==c){let g=new G(d+1);f.children.unshift(g),e=g.id;break}b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e}"] textarea`)?.focus()};const Wa=a=>{let c=q(a.target);for(let{section:d,parent:e}of z(b.now.children,b.now)){if(d.id!=c)continue;e.children=e.children.filter(f=>f!=d)}b.hasChanged=!0,n(),t()};const Xa=a=>{let c=q(a.target),d=D(c);d.text=a.target.value,b.hasChanged=!0,n()};const S={addSiblingSection:Ua,addChildSection:Va,removeSection:Wa,updateSection:Xa};const Ja=a=>{let c=q(a.target),d=D(c),e=new Aa();e.type=b.now.fieldTypes[0],d.fields.push(e),b.hasChanged=!0,t(),b.isMobile||document.querySelector(`[id="${e.id}"] input`)?.focus()};const Ka=a=>{let c=q(a.target),d=D(c),e=V(a.target);d.fields=d.fields.filter(f=>f.id!=e),b.hasChanged=!0,t(),n()};const La=a=>{let c=q(a.target),d=D(c),e=V(a.target),f=d.fields.find(h=>h.id==e);f.value=a.target.value,b.hasChanged=!0,n()};const Ma=a=>{let c=a.target.value,d=V(a.target),e=q(a.target),f=D(e),h=f.fields.find(g=>g.id==d);h.type=b.now.fieldTypes.find(g=>g.id==c),b.hasChanged=!0,n()};const N={addField:Ja,removeField:Ka,updateFieldValue:La,updateFieldType:Ma};const Ya=a=>{let c=a.target.textContent||"";a.target.id.includes("global")&&(b.now.selected.globalType.css=c,b.hasChanged=!0),a.target.id.includes("field")&&(b.now.selected.fieldType.css=c,b.hasChanged=!0),ua()};const W=a=>{let c=a.target||a,d=(e,f)=>`<span class="token ${f}">${e}</span>`;c.innerHTML=c.innerText.replace(/\n/g,"").replace(/;/g,d(";","newline")).replace(/[,:](?!\s)/g,e=>e+" ")};const Za=a=>{let c=a.target.value,d=u("field_type_styles"),e=b.now.fieldTypes.find(f=>f.id==c);if(e)e.css||(e.css=""),b.now.selected.fieldType=e;else{let f={id:c,css:""};b.now.fieldTypes.push(f),b.now.selected.fieldType=f}d.innerHTML=b.now.selected.fieldType.css,W(d),b.hasChanged=!0,n()};const _a=a=>{let c=u("global_type_styles"),d=a.target.value,e=b.now.globalTypes.find(f=>f.name==d);if(e)e.css||(e.css=""),b.now.selected.globalType=e;else{let f={id:d,css:""};b.now.globalTypes.push(f),b.now.selected.globalType=f}c.innerHTML=b.now.selected.globalType.css,W(c),b.hasChanged=!0,n()};const y={updateStyles:Ya,updateCurrentFieldType:Za,updateCurrentGlobalType:_a,formatCSS:W};const Fa=a=>{if(a=="template"){b.templates=b.templates.filter(c=>JSON.parse(c).id!=b.now.selected.template.id);try{b.now.selected.template=JSON.parse(b.templates?.[0])||{}}catch(c){}}a=="field type"&&(b.now.fieldTypes=b.now.fieldTypes.filter(c=>c.id!=b.now.selected.fieldType.id),b.now.selected.template.fieldTypes=b.now.fieldTypes,b.now.selected.fieldType=b.now.fieldTypes?.[0]||{}),b.now.editing={},b.hasChanged=!0,p(),s(null)};const Ga=a=>{b.now.editing[a.target.name]=a.target.value,b.now.editing?.type=="template"&&b.templates.map((c,d)=>{let e=JSON.parse(c),f=e.id==b.now.editing.id;f&&b.templates.splice(d,1,JSON.stringify(b.now.editing))}),b.hasChanged=!0,p()};const Ia=()=>{b.now.selected.fieldType=b.now.fieldTypes[b.now.fieldTypes.length-1],b.now.selected.template.fieldTypes=b.now.fieldTypes;if(b.now.fieldTypes.length==1)for(let{section:a,parent:c}of z(b.now.children))a.fields.map(d=>d.type=b.now.fieldTypes[0])};const Ha=a=>{b.now.editing.name=b.now.editing.name.trim();if(!b.now.editing.name.length){s(null);return}a=="field type"&&(b.now.fieldTypes.push(new ca(b.now.editing.name)),Ia(),w.styleEditorPane.querySelector("code")?.focus());if(a=="template"){let c=new da(b.now.editing.name);c.fieldTypes=b.now.fieldTypes,c.globalTypes=b.now.globalTypes,b.templates.push(JSON.stringify(c)),b.now.selected.template=c}b.now.editing={},b.hasChanged=!0,p(),s(null)};const $={removeType:Fa,updateType:Ga,saveNewType:Ha};const Na=a=>{let c=b.settings.darkMode;document.documentElement.classList.toggle("dark_mode",!c),b.settings.darkMode=!c,b.hasChanged=!0,B()};const Oa=a=>{let c=b.settings.advancedUI;document.documentElement.classList.toggle("advanced",!c),b.settings.advancedUI=!c,b.hasChanged=!0,B()};const ja=a=>{if(!confirm("Are you sure you want to load this template?"))return;for(let c of b.templates){let d=JSON.parse(c);if(d.id==a.target.value){b.now.selected.template=d,L(),p(),b.hasChanged=!0;break}}};const Pa=a=>window.print();const Qa=a=>{let c=a.target.files[0],d=new FileReader();d.onerror=function(){console.error(this.error)},d.onload=function(){let e=JSON.parse(this.result);Object.keys(b).map(f=>b[f]=e[f]),L(),p()},document.body.classList.add("importing"),d.readAsText(c)};O;const Ra=a=>{b.now.children=[new G()],b.now.fieldTypes=[],b.now.globalTypes=r.map(c=>new O(c)).concat(Object.values(M).map(c=>new O(c))),b.now.editing={},b.now.selected={fieldType:{},globalType:{},template:{}},b.templates=[],p(),b.now.children.push(new G()),renderContentEditor(),b.hasChanged=!0};const Sa=a=>{document.body.setAttribute("data-selected-pane",a)};const Ta=(a="")=>{let c=a.toLowerCase(),d=b.settings.zoom;c=="out"&&d>H.zoom.min&&(d=d-H.zoom.interval),c=="in"&&d<H.zoom.max&&(d=d+H.zoom.interval),d!=b.settings.zoom&&(b.settings.zoom=d,b.hasChanged=!0,B())};const C={toggleDarkMode:Na,toggleAdvancedUI:Oa,loadTemplate:ja,printDocument:Pa,importData:Qa,clearData:Ra,switchPane:Sa,zoom:Ta};const ia=({global:a=!1,field:c={}}={})=>{if(!b.now.fieldTypes?.length)return;let d=a?b.now.selected.fieldType?.id:c?.type?.id;return i`
    <select name=type @input=${a?y.updateCurrentFieldType:N.updateFieldType}>

        ${b.now.fieldTypes.map(e=>i`
            <option value=${e.id} ?selected=${e.id==d}>
                ${e.name}
            </option>
        `)}

    </select>`};const Da=(a,c,d)=>i`
<div 
class=field 
id=${a.id}>

    <input 
    placeholder="Field value..."
    type=text 
    .value=${a.value} 
    @input=${N.updateFieldValue} />

    ${ia({field:a})}

    <button 
    @click=${N.removeField} 
    class=remove>
        Remove
    </button>

    <button
    data-icon
    @click=${ga.bind(void 0,c,"fields",d)}
    ?disabled=${d>=c.fields.length-1}
    class="move moveDown">
    </button>

    <button
    data-icon
    @click=${ha.bind(void 0,c,"fields",d)}
    ?disabled=${!d} 
    class="move moveUp">
    </button>

</div>`;function ea(a,c,d){let e=b.now.children.length,f=a.depth,h=f==r.length-1;return i`
    <section 
    id=${a.id} 
    data-section-depth=${a.depth}>

        <div class=fields>
            ${a.fields.map((g,l)=>Da(g,a,l))}
        </div>

        <textarea 
        id="${a.id}-text"
        placeholder=${"Write something for this "+r[f].toLowerCase()+"..."} 
        @input=${S.updateSection} 
        .value=${a.text}>
        </textarea>

        <div class=actions>

            <button 
            data-icon=add_another
            title=${"Add "+r[f]}
            @click=${S.addSiblingSection}>
            </button>

            ${h?"":i`
            <button 
            data-icon=add_sub
            title=${"Add "+r[f+1]}
            @click=${S.addChildSection}>
            </button>`}

            <button 
            class=add
            data-icon
            title="Add Field"
            @click=${N.addField}>
            </button>

            ${e>1||f?i`
            <button 
            class=remove
            @click=${S.removeSection}>
            Remove
            </button>`:""}

            ${c.children.length>1?i`

            <button 
            class="move moveDown" 
            data-icon
            title="Move Down"
            ?disabled=${d>=c.children.length-1} 
            @click=${ga.bind(this,c,"children",d)}>
            </button>

            <button 
            class="move moveUp"
            data-icon
            title="Move Up"
            ?disabled=${!d} 
            @click=${ha.bind(this,c,"children",d)}>
            </button>
            
            `:""}

        </div>

        ${a.children.length?a.children.map((g,l)=>ea(g,a,l)):""}

    </section>`}const vb={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function ob(a){return a.replace(RegExp("^"+(a.match(/^(\t| )+/)||"")[0],"gm"),"")}function ba(a){return(a+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function T(a,c){let d=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,e=[],f="",h=c||{},g=0,l,J,j,k,m;function Q(o){let v=vb[o[1]||""],A=e[e.length-1]==o;return v?v[1]?(A?e.pop():e.push(o),v[A|0]):v[0]:o}function F(){let o="";for(;e.length;)o+=Q(e[e.length-1]);return o}for(a=a.replace(/^\[(.+?)\]:\s*(.+)$/gm,(o,v,A)=>(h[v.toLowerCase()]=A,"")).replace(/^\n+|\n+$/g,"");j=d.exec(a);)J=a.substring(g,j.index),g=d.lastIndex,l=j[0],J.match(/[^\\](\\\\)*\\$/)||((m=j[3]||j[4])?l='<pre class="code '+(j[4]?"poetry":j[2].toLowerCase())+'"><code'+(j[2]?` class="language-${j[2].toLowerCase()}"`:"")+">"+ob(ba(m).replace(/^\n+|\n+$/g,""))+"</code></pre>":(m=j[6])?(m.match(/\./)&&(j[5]=j[5].replace(/^\d+/gm,"")),k=T(ob(j[5].replace(/^\s*[>*+.-]/gm,""))),m==">"?m="blockquote":(m=m.match(/\./)?"ol":"ul",k=k.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),l="<"+m+">"+k+"</"+m+">"):j[8]?l=`<img src="${ba(j[8])}" alt="${ba(j[7])}">`:j[10]?(f=f.replace("<a>",`<a href="${ba(j[11]||h[J.toLowerCase()])}">`),l=F()+"</a>"):j[9]?l="<a>":j[12]||j[14]?(m="h"+(j[14]?j[14].length:j[13]>"="?1:2),l="<"+m+">"+T(j[12]||j[15],h)+"</"+m+">"):j[16]?l="<code>"+ba(j[16])+"</code>":(j[17]||j[1])&&(l=Q(j[17]||"--"))),f+=J,f+=l;return(f+a.substring(g)+F()).replace(/^\n+|\n+$/g,"")}const Ea=a=>{let c=b.now.fieldTypes.find(e=>e.id==a?.type?.id),d=document.createElement("div");return d.innerHTML=T(a.value),/<p>/.test(d.innerHTML)&&(d.innerHTML=d.firstElementChild.innerHTML),i`
    <div class=${_(c?.name||"")}>
        ${d}
    </div>`};function fa(a){let c=document.createElement("div");return c.classList.add("content"),c.innerHTML=T(a.text),i`
    <section class=${r[a.depth]}>
    
        ${a.fields.map(d=>Ea(d))}
    
        ${a.text.length?c:""}
    
        ${a.children.map(d=>fa(d))}
    
    </section>`}const qa=()=>i`

<div class="heading">
    Style Editor
    <span tabindex="0" data-tooltip="This pane is for editing your document's styles. Apply valid CSS rules to any custom field type or global element."></span>
</div>

<section id=manageFieldTypes>

    <div class=actions>

        <label>Field Styles</label>

        ${ia({global:!0})}

        ${b.now.fieldTypes?.length?i`
        <button 
        data-icon
        title="Edit Field Type"
        @click=${s.bind(void 0,"field type",!0)}>
        </button>`:""}

        <button 
        class=add 
        data-icon
        title="New Field Type"
        @click=${s.bind(void 0,"field type",!1)}>
        </button>
        
    </div>

    <code 
    spellcheck=false
    id=field_type_styles
    class=language-css 
    contenteditable=true 
    @focusout=${y.formatCSS}
    @keyup=${y.updateStyles}></code>
    
</section>


<section id=manageGlobalTypes>

    <div class=actions>

        <label>Global Styles</label>

        <select id=global-style-select @input=${y.updateCurrentGlobalType}>

            <optgroup label=Layout>
            ${r.map(a=>i`
                <option
                value=${a}
                ?selected=${a==b.now.selected.globalType?.name}>
                    ${a}s
                </option>
            `)}
            </optgroup>

            <optgroup label=Elements>
                ${Object.values(M).map(a=>i`
                    <option 
                    label=${a}
                    value=${a}
                    ?selected=${a==b.now.selected.globalType?.name}>
                        ${a}s
                    </option>
                `)}
            </optgroup>
        </select>

    </div>

    <code
    spellcheck=false
    id=global_type_styles
    class=language-css
    contenteditable=true
    @focusout=${y.formatCSS}
    @keyup=${y.updateStyles}></code>

</section>
`;const ra=()=>i`

${b.now.fieldTypes.map(a=>`#preview .${_(a.name).trim()}{${a.css}}`)}

${r.map(a=>{let c=b.now.globalTypes.find(d=>d.name==a);return`#preview .${_(a).trim()}{${c?.css}}`})}

${Object.keys(M).map(a=>{let c=M[a],d=b.now.globalTypes.find(e=>e.name==c);return`#preview ${a} {${d?.css}}`})}
`;const oa=(a=0)=>{let c=b.nowIndex+a;b.now=JSON.parse(b.history[c]),b.nowIndex=c,L(),p()};const sa=()=>{let a=b.settings;return i`


    <!-- Undo/Redo -->
    <div class=configuration id=undo_redo>

        <button
        data-icon
        title=Undo
        ?disabled=${b.nowIndex==0}
        @click=${oa.bind(void 0,-1)}>
        </button>

        <button
        data-icon
        title=Redo
        ?disabled=${b.nowIndex>=b.history.length-1}
        @click=${oa.bind(void 0,1)}>
        </button>

    </div>


    <!-- Zoom -->
    <div class=configuration id=zoom>

        <button
        data-icon
        title="Zoom Out"
        @click=${C.zoom.bind(void 0,"out")}>
        </button>

        <button
        data-icon
        title="Zoom In"
        @click=${C.zoom.bind(void 0,"in")}>
        </button>

        <label>${"("+Math.round(a.zoom*100)+"%)"}</label>

    </div>
    

    <!-- Toggle Dark Mode -->
    <div class=configuration>

        <button 
        data-icon 
        title=${"You're in "+(a.darkMode?"Dark":"Light")+" Mode"}
        ?aria-pressed=${a.darkMode}
        @click=${C.toggleDarkMode}
        id=dark_mode_toggle>
        </button>

    </div>
    

    <!-- Toggle Advanced UI -->
    <div class=configuration id=advancedUI_toggle>

        <button
        data-icon
        id="advanced_toggle"
        ?aria-pressed=${a.advancedUI}
        title=${(a.advancedUI?"Disable":"Enable")+" Advanced UI"}
        @click=${C.toggleAdvancedUI}>
        </button>

    </div>
    

    <!-- Template Management -->
    <div class=configuration id=manageTemplates>

        <!-- Select Template -->
    ${b.templates.length?i`
        <select 
        title=${"Current Template: "+b.now.selected.template.name} 
        @input=${ja}>

    ${b.templates.map(c=>{let d=JSON.parse(c),e=b.now.selected.template.id==d.id;return i`
            <option 
            ?selected=${e}
            value=${d.id}>
                ${d.name}
            </option>`})}

        </select>

        <!-- Edit Template -->
        <button
        data-icon
        title="Edit Template"
        @click=${s.bind(void 0,"template",!0)}>
        </button>

        `:U}

        <!-- Save New Template -->
        <button
        data-icon
        title="New Template"
        @click=${s.bind(void 0,"template",!1)}>
        </button>

    </div>


    <!-- Print Document -->
    <div class=configuration id=printDocument>
        <button 
        data-icon
        title=Print
        @click=${C.printDocument}>
        </button>
    </div>


    <!-- Import and Export Data -->
    <div class=configuration id=import_export>

        <a 
        class="button primary"
        data-icon
        title="Export Data"
        id=exportData
        .href=${b?.forExport}
        download=${`My Data (${new Date(b.lastSaved).toLocaleDateString()}).json`}
        >
        </a>

        <input
        aria-hidden="true"
        id=importData
        type=file
        accept=.json
        @input=${C.importData}>

        <label 
        data-icon
        title="Import Data"
        class="fileInput secondary"
        for=importData>
        </label>

        <!-- Clear Data -->
        <button
        data-icon
        title="Clear Data"
        class=destructive
        @click=${C.clearData}>
        </button>

    </div>


    <!-- Last Saved -->
    ${b.lastSaved?i`
    <div class=configuration>
            Saved: ${new Date(b.lastSaved).toLocaleTimeString("en-us",{timeStyle:"short"})}
    </div>
    `:U}
    `};const ta=(a,c)=>a?(a=="field type"&&(b.now.editing=c?b.now.selected.fieldType:new ca()),a=="template"&&(b.now.editing=c?b.now.selected.template:new da()),i`
    <div class=content>
        
        <div class=heading>
            ${b.now.editing.type} Editor
            <span
            tabindex=0 
            data-tooltip=${"This pane is for renaming or editing your "+b.now.editing.type+"."}>
            </span>
        </div>

        <input 
        name=name 
        @input=${$.updateType} 
        type=text 
        placeholder=${"Name your "+b.now.editing.type+"..."}
        value=${c?b.now.editing.name:""} />
        
        <div class=actions>

            <button 
            @click=${c?s.bind(void 0,null):$.saveNewType.bind(void 0,b.now.editing.type)}>
                Done
            </button>

            ${c?i`
            <button 
            class=remove 
            @click=${$.removeType.bind(void 0,b.now.editing.type)}>
                Delete ${b.now.editing.type}
            </button>`:""}

            <button 
            class=cancel 
            @click=${s.bind(void 0,null)}>
                Cancel
            </button>
            
        </div>

    </div>`):"";async function p(){t(),B(),n(),$a(),ua()}async function n(){P(i`
        <div class=content>
            ${b.now.children.map(a=>fa(a))}
        </div>`,w.previewPane)}async function B(){let a=document.documentElement;a.style.setProperty("--preview_zoom",b.settings.zoom),a.classList.toggle("dark_mode",b.settings.darkMode),a.classList.toggle("advanced",b.settings.advancedUI),P(sa(),w.toolbar)}function ua(){P(ra(),w.customStyles)}function s(a,c=!1){w.modal.classList.toggle("open",a),P(ta(a,c),w.modal);if(a)try{w.modal.querySelector("input").focus()}catch(d){}a||(b.now.editing={},B(),$a(),n())}function $a(){P(qa(),w.styleEditorPane);for(let a of w.styleEditorPane.querySelectorAll("code"))a.innerHTML="",a.id.includes("field")&&(a.innerText=b.now.selected.fieldType?.css||""),a.id.includes("global")&&(a.innerText=b.now.selected.globalType?.css||""),y?.formatCSS({target:a})}function t(){P(i`
        <div class=heading>
            Content Editor
            <span tabindex=0
                data-tooltip="This pane is for editing the content of your document. Try nesting content blocks or adding custom fields to a section."></span>
        </div>
        
        ${b.now.children.map((a,c)=>ea(a,b.now,c))}
        `,w.contentEditorPane)}async function pa(a=!1){if(!b.hasChanged&&!a)return;b.templates.map((f,h)=>{let g=JSON.parse(f),l=g.id==b.now.selected.template.id;l&&b.templates.splice(h,1,JSON.stringify(b.now.selected.template))}),localStorage.setItem("State",JSON.stringify(b)),b.history.push(JSON.stringify(b.now)),b.nowIndex=b.history.length-1,b.history.length>250&&b.history.splice(0,1),b.hasChanged=!1,b.lastSaved=new Date().getTime();let c=JSON.stringify(b,(f,h)=>f=="history"?[]:h),d=new Blob([c],{type:"application/json"}),e=URL.createObjectURL(d);b.forExport=e,B()}b.isNewUser&&!b.now.children.length&&(b.now.children.push(new G()),pa(!0));L();p();setInterval(pa,H.saveInterval);document.body.classList.remove("loading");b.isMobile=innerWidth<H.mobileBreakpoint;for(let a of document.querySelectorAll("[data-icon]"))a.setAttribute("aria-hidden",!0);})();
